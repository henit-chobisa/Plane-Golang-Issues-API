
BEGIN;
--
-- Create model User
--
CREATE TABLE "user" ("password" varchar(128) NOT NULL, "last_login" timestamp with time zone NULL, "id" uuid NOT NULL PRIMARY KEY, "username" varchar(128) NOT NULL UNIQUE, "mobile_number" varchar(255) NULL, "email" varchar(255) NULL UNIQUE, "first_name" varchar(255) NOT NULL, "last_name" varchar(255) NOT NULL, "avatar" varchar(255) NOT NULL, "date_joined" timestamp with time zone NOT NULL, "created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "last_location" varchar(255) NOT NULL, "created_location" varchar(255) NOT NULL, "is_superuser" boolean NOT NULL, "is_managed" boolean NOT NULL, "is_password_expired" boolean NOT NULL, "is_active" boolean NOT NULL, "is_staff" boolean NOT NULL, "is_email_verified" boolean NOT NULL, "is_password_autoset" boolean NOT NULL, "is_onboarded" boolean NOT NULL, "token" varchar(64) NOT NULL, "billing_address_country" varchar(255) NOT NULL, "billing_address" jsonb NULL, "has_billing_address" boolean NOT NULL, "user_timezone" varchar(255) NOT NULL, "last_active" timestamp with time zone NULL, "last_login_time" timestamp with time zone NULL, "last_logout_time" timestamp with time zone NULL, "last_login_ip" varchar(255) NOT NULL, "last_logout_ip" varchar(255) NOT NULL, "last_login_medium" varchar(20) NOT NULL, "last_login_uagent" text NOT NULL, "token_updated_at" timestamp with time zone NULL, "last_workspace_id" uuid NULL);
CREATE TABLE "user_groups" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "user_id" uuid NOT NULL, "group_id" integer NOT NULL);
CREATE TABLE "user_user_permissions" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "user_id" uuid NOT NULL, "permission_id" integer NOT NULL);
--
-- Create model Cycle
--
CREATE TABLE "cycle" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "start_date" date NOT NULL, "end_date" date NOT NULL, "status" varchar(255) NOT NULL, "created_by_id" uuid NULL, "owned_by_id" uuid NOT NULL);
--
-- Create model Issue
--
CREATE TABLE "issue" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" jsonb NOT NULL, "priority" varchar(30) NULL, "start_date" date NULL, "target_date" date NULL, "sequence_id" integer NOT NULL, "attachments" varchar(200)[10] NOT NULL);
--
-- Create model Project
--
CREATE TABLE "project" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "description_rt" jsonb NULL, "description_html" jsonb NULL, "network" smallint NOT NULL CHECK ("network" >= 0), "identifier" varchar(5) NULL, "slug" varchar(100) NOT NULL, "created_by_id" uuid NULL, "default_assignee_id" uuid NULL, "project_lead_id" uuid NULL, "updated_by_id" uuid NULL);
--
-- Create model Team
--
CREATE TABLE "team" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "created_by_id" uuid NULL);
--
-- Create model Workspace
--
CREATE TABLE "workspace" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "logo" varchar(200) NULL, "slug" varchar(100) NOT NULL UNIQUE, "created_by_id" uuid NULL, "owner_id" uuid NOT NULL, "updated_by_id" uuid NULL);
--
-- Create model WorkspaceMemberInvite
--
CREATE TABLE "workspace_member_invite" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "email" varchar(255) NOT NULL, "accepted" boolean NOT NULL, "token" varchar(255) NOT NULL, "message" text NULL, "responded_at" timestamp with time zone NULL, "role" smallint NOT NULL CHECK ("role" >= 0), "created_by_id" uuid NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model View
--
CREATE TABLE "view" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "query" jsonb NOT NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model TimelineIssue
--
CREATE TABLE "issue_timeline" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "sequence_id" double precision NOT NULL, "links" jsonb NOT NULL, "created_by_id" uuid NULL, "issue_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model TeamMember
--
CREATE TABLE "team_member" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "member_id" uuid NOT NULL, "team_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Add field members to team
--
-- (no-op)
--
-- Add field updated_by to team
--
ALTER TABLE "team" ADD COLUMN "updated_by_id" uuid NULL CONSTRAINT "team_updated_by_id_79bb36f2_fk_user_id" REFERENCES "user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "team_updated_by_id_79bb36f2_fk_user_id" IMMEDIATE;
--
-- Add field workspace to team
--
ALTER TABLE "team" ADD COLUMN "workspace_id" uuid NOT NULL CONSTRAINT "team_workspace_id_1d56407f_fk_workspace_id" REFERENCES "workspace"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "team_workspace_id_1d56407f_fk_workspace_id" IMMEDIATE;
--
-- Create model State
--
CREATE TABLE "state" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "color" varchar(255) NOT NULL, "slug" varchar(100) NOT NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model SocialLoginConnection
--
CREATE TABLE "social_login_connection" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "medium" varchar(20) NOT NULL, "last_login_at" timestamp with time zone NULL, "last_received_at" timestamp with time zone NULL, "token_data" jsonb NULL, "extra_data" jsonb NULL, "created_by_id" uuid NULL, "updated_by_id" uuid NULL, "user_id" uuid NOT NULL);
--
-- Create model Shortcut
--
CREATE TABLE "shortcut" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "type" varchar(255) NOT NULL, "url" varchar(200) NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model ProjectMemberInvite
--
CREATE TABLE "project_member_invite" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "email" varchar(255) NOT NULL, "accepted" boolean NOT NULL, "token" varchar(255) NOT NULL, "message" text NULL, "responded_at" timestamp with time zone NULL, "role" smallint NOT NULL CHECK ("role" >= 0), "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model ProjectIdentifier
--
CREATE TABLE "project_identifier" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "name" varchar(10) NOT NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL UNIQUE, "updated_by_id" uuid NULL);
--
-- Add field workspace to project
--
ALTER TABLE "project" ADD COLUMN "workspace_id" uuid NOT NULL CONSTRAINT "project_workspace_id_01764ff9_fk_workspace_id" REFERENCES "workspace"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "project_workspace_id_01764ff9_fk_workspace_id" IMMEDIATE;
--
-- Create model Label
--
CREATE TABLE "label" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model IssueSequence
--
CREATE TABLE "issue_sequence" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "sequence" bigint NOT NULL CHECK ("sequence" >= 0), "deleted" boolean NOT NULL, "created_by_id" uuid NULL, "issue_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model IssueProperty
--
CREATE TABLE "issue_property" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "properties" jsonb NOT NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "user_id" uuid NOT NULL UNIQUE, "workspace_id" uuid NOT NULL);
--
-- Create model IssueLabel
--
CREATE TABLE "issue_label" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "issue_id" uuid NOT NULL, "label_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model IssueComment
--
CREATE TABLE "issue_comment" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "comment" text NOT NULL, "attachments" varchar(200)[10] NOT NULL, "created_by_id" uuid NULL, "issue_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model IssueBlocker
--
CREATE TABLE "issue_blocker" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "block_id" uuid NOT NULL, "blocked_by_id" uuid NOT NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model IssueAssignee
--
CREATE TABLE "issue_assignee" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "assignee_id" uuid NOT NULL, "created_by_id" uuid NULL, "issue_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model IssueActivity
--
CREATE TABLE "issue_activity" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "verb" varchar(255) NOT NULL, "field" varchar(255) NULL, "old_value" varchar(255) NULL, "new_value" varchar(255) NULL, "comment" text NOT NULL, "attachments" varchar(200)[10] NOT NULL, "created_by_id" uuid NULL, "issue_id" uuid NOT NULL, "issue_comment_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Add field assignees to issue
--
-- (no-op)
--
-- Add field created_by to issue
--
ALTER TABLE "issue" ADD COLUMN "created_by_id" uuid NULL CONSTRAINT "issue_created_by_id_8f0ae62b_fk_user_id" REFERENCES "user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "issue_created_by_id_8f0ae62b_fk_user_id" IMMEDIATE;
--
-- Add field labels to issue
--
-- (no-op)
--
-- Add field parent to issue
--
ALTER TABLE "issue" ADD COLUMN "parent_id" uuid NULL CONSTRAINT "issue_parent_id_ce8d76ba_fk_issue_id" REFERENCES "issue"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "issue_parent_id_ce8d76ba_fk_issue_id" IMMEDIATE;
--
-- Add field project to issue
--
ALTER TABLE "issue" ADD COLUMN "project_id" uuid NOT NULL CONSTRAINT "issue_project_id_fea0fc80_fk_project_id" REFERENCES "project"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "issue_project_id_fea0fc80_fk_project_id" IMMEDIATE;
--
-- Add field state to issue
--
ALTER TABLE "issue" ADD COLUMN "state_id" uuid NULL CONSTRAINT "issue_state_id_1a65560d_fk_state_id" REFERENCES "state"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "issue_state_id_1a65560d_fk_state_id" IMMEDIATE;
--
-- Add field updated_by to issue
--
ALTER TABLE "issue" ADD COLUMN "updated_by_id" uuid NULL CONSTRAINT "issue_updated_by_id_f1261863_fk_user_id" REFERENCES "user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "issue_updated_by_id_f1261863_fk_user_id" IMMEDIATE;
--
-- Add field workspace to issue
--
ALTER TABLE "issue" ADD COLUMN "workspace_id" uuid NOT NULL CONSTRAINT "issue_workspace_id_c84878c1_fk_workspace_id" REFERENCES "workspace"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "issue_workspace_id_c84878c1_fk_workspace_id" IMMEDIATE;
--
-- Create model FileAsset
--
CREATE TABLE "file_asset" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "attributes" jsonb NOT NULL, "asset" varchar(100) NOT NULL, "created_by_id" uuid NULL, "updated_by_id" uuid NULL);
--
-- Create model CycleIssue
--
CREATE TABLE "cycle_issue" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "cycle_id" uuid NOT NULL, "issue_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Add field project to cycle
--
ALTER TABLE "cycle" ADD COLUMN "project_id" uuid NOT NULL CONSTRAINT "cycle_project_id_0b590349_fk_project_id" REFERENCES "project"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "cycle_project_id_0b590349_fk_project_id" IMMEDIATE;
--
-- Add field updated_by to cycle
--
ALTER TABLE "cycle" ADD COLUMN "updated_by_id" uuid NULL CONSTRAINT "cycle_updated_by_id_93baee43_fk_user_id" REFERENCES "user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "cycle_updated_by_id_93baee43_fk_user_id" IMMEDIATE;
--
-- Add field workspace to cycle
--
ALTER TABLE "cycle" ADD COLUMN "workspace_id" uuid NOT NULL CONSTRAINT "cycle_workspace_id_a199e8e1_fk_workspace_id" REFERENCES "workspace"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "cycle_workspace_id_a199e8e1_fk_workspace_id" IMMEDIATE;
--
-- Create model WorkspaceMember
--
CREATE TABLE "workspace_member" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "role" smallint NOT NULL CHECK ("role" >= 0), "created_by_id" uuid NULL, "member_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Alter unique_together for team (1 constraint(s))
--
ALTER TABLE "team" ADD CONSTRAINT "team_name_workspace_id_9538db2e_uniq" UNIQUE ("name", "workspace_id");
--
-- Create model ProjectMember
--
CREATE TABLE "project_member" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "comment" text NULL, "role" smallint NOT NULL CHECK ("role" >= 0), "created_by_id" uuid NULL, "member_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Alter unique_together for project (1 constraint(s))
--
ALTER TABLE "project" ADD CONSTRAINT "project_name_workspace_id_e858a38f_uniq" UNIQUE ("name", "workspace_id");
CREATE INDEX "user_username_cf016618_like" ON "user" ("username" varchar_pattern_ops);
CREATE INDEX "user_email_54dc62b2_like" ON "user" ("email" varchar_pattern_ops);
ALTER TABLE "user_groups" ADD CONSTRAINT "user_groups_user_id_group_id_40beef00_uniq" UNIQUE ("user_id", "group_id");
ALTER TABLE "user_groups" ADD CONSTRAINT "user_groups_user_id_abaea130_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "user_groups" ADD CONSTRAINT "user_groups_group_id_b76f8aba_fk_auth_group_id" FOREIGN KEY ("group_id") REFERENCES "auth_group" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "user_groups_user_id_abaea130" ON "user_groups" ("user_id");
CREATE INDEX "user_groups_group_id_b76f8aba" ON "user_groups" ("group_id");
ALTER TABLE "user_user_permissions" ADD CONSTRAINT "user_user_permissions_user_id_permission_id_7dc6e2e0_uniq" UNIQUE ("user_id", "permission_id");
ALTER TABLE "user_user_permissions" ADD CONSTRAINT "user_user_permissions_user_id_ed4a47ea_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "user_user_permissions" ADD CONSTRAINT "user_user_permission_permission_id_9deb68a3_fk_auth_perm" FOREIGN KEY ("permission_id") REFERENCES "auth_permission" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "user_user_permissions_user_id_ed4a47ea" ON "user_user_permissions" ("user_id");
CREATE INDEX "user_user_permissions_permission_id_9deb68a3" ON "user_user_permissions" ("permission_id");
ALTER TABLE "cycle" ADD CONSTRAINT "cycle_created_by_id_78e43b79_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle" ADD CONSTRAINT "cycle_owned_by_id_5456a4d1_fk_user_id" FOREIGN KEY ("owned_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "cycle_created_by_id_78e43b79" ON "cycle" ("created_by_id");
CREATE INDEX "cycle_owned_by_id_5456a4d1" ON "cycle" ("owned_by_id");
ALTER TABLE "project" ADD CONSTRAINT "project_created_by_id_6cc13408_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project" ADD CONSTRAINT "project_default_assignee_id_6ba45f90_fk_user_id" FOREIGN KEY ("default_assignee_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project" ADD CONSTRAINT "project_project_lead_id_caf8e353_fk_user_id" FOREIGN KEY ("project_lead_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project" ADD CONSTRAINT "project_updated_by_id_fe290525_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "project_slug_347e0619" ON "project" ("slug");
CREATE INDEX "project_slug_347e0619_like" ON "project" ("slug" varchar_pattern_ops);
CREATE INDEX "project_created_by_id_6cc13408" ON "project" ("created_by_id");
CREATE INDEX "project_default_assignee_id_6ba45f90" ON "project" ("default_assignee_id");
CREATE INDEX "project_project_lead_id_caf8e353" ON "project" ("project_lead_id");
CREATE INDEX "project_updated_by_id_fe290525" ON "project" ("updated_by_id");
ALTER TABLE "team" ADD CONSTRAINT "team_created_by_id_725a9101_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "team_created_by_id_725a9101" ON "team" ("created_by_id");
ALTER TABLE "workspace" ADD CONSTRAINT "workspace_name_owner_id_56867b58_uniq" UNIQUE ("name", "owner_id");
ALTER TABLE "workspace" ADD CONSTRAINT "workspace_created_by_id_10ad894e_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace" ADD CONSTRAINT "workspace_owner_id_60a8bafc_fk_user_id" FOREIGN KEY ("owner_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace" ADD CONSTRAINT "workspace_updated_by_id_09d249ed_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "workspace_slug_4d89d459_like" ON "workspace" ("slug" varchar_pattern_ops);
CREATE INDEX "workspace_created_by_id_10ad894e" ON "workspace" ("created_by_id");
CREATE INDEX "workspace_owner_id_60a8bafc" ON "workspace" ("owner_id");
CREATE INDEX "workspace_updated_by_id_09d249ed" ON "workspace" ("updated_by_id");
ALTER TABLE "workspace_member_invite" ADD CONSTRAINT "workspace_member_invite_created_by_id_082f21d3_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_member_invite" ADD CONSTRAINT "workspace_member_invite_updated_by_id_d31a9c7f_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_member_invite" ADD CONSTRAINT "workspace_member_invite_workspace_id_d935b364_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "workspace_member_invite_created_by_id_082f21d3" ON "workspace_member_invite" ("created_by_id");
CREATE INDEX "workspace_member_invite_updated_by_id_d31a9c7f" ON "workspace_member_invite" ("updated_by_id");
CREATE INDEX "workspace_member_invite_workspace_id_d935b364" ON "workspace_member_invite" ("workspace_id");
ALTER TABLE "view" ADD CONSTRAINT "view_created_by_id_785ff660_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "view" ADD CONSTRAINT "view_project_id_44d19499_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "view" ADD CONSTRAINT "view_updated_by_id_6ae36340_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "view" ADD CONSTRAINT "view_workspace_id_2ef72485_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "view_created_by_id_785ff660" ON "view" ("created_by_id");
CREATE INDEX "view_project_id_44d19499" ON "view" ("project_id");
CREATE INDEX "view_updated_by_id_6ae36340" ON "view" ("updated_by_id");
CREATE INDEX "view_workspace_id_2ef72485" ON "view" ("workspace_id");
ALTER TABLE "issue_timeline" ADD CONSTRAINT "issue_timeline_created_by_id_0cff104c_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_timeline" ADD CONSTRAINT "issue_timeline_issue_id_0e4dc65a_fk_issue_id" FOREIGN KEY ("issue_id") REFERENCES "issue" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_timeline" ADD CONSTRAINT "issue_timeline_project_id_320d52be_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_timeline" ADD CONSTRAINT "issue_timeline_updated_by_id_6c3e76b4_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_timeline" ADD CONSTRAINT "issue_timeline_workspace_id_a23baf87_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_timeline_created_by_id_0cff104c" ON "issue_timeline" ("created_by_id");
CREATE INDEX "issue_timeline_issue_id_0e4dc65a" ON "issue_timeline" ("issue_id");
CREATE INDEX "issue_timeline_project_id_320d52be" ON "issue_timeline" ("project_id");
CREATE INDEX "issue_timeline_updated_by_id_6c3e76b4" ON "issue_timeline" ("updated_by_id");
CREATE INDEX "issue_timeline_workspace_id_a23baf87" ON "issue_timeline" ("workspace_id");
ALTER TABLE "team_member" ADD CONSTRAINT "team_member_team_id_member_id_d0325b97_uniq" UNIQUE ("team_id", "member_id");
ALTER TABLE "team_member" ADD CONSTRAINT "team_member_created_by_id_7cc0ad68_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "team_member" ADD CONSTRAINT "team_member_member_id_905a2628_fk_user_id" FOREIGN KEY ("member_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "team_member" ADD CONSTRAINT "team_member_team_id_26812b86_fk_team_id" FOREIGN KEY ("team_id") REFERENCES "team" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "team_member" ADD CONSTRAINT "team_member_updated_by_id_b1d37059_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "team_member" ADD CONSTRAINT "team_member_workspace_id_5e13a185_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "team_member_created_by_id_7cc0ad68" ON "team_member" ("created_by_id");
CREATE INDEX "team_member_member_id_905a2628" ON "team_member" ("member_id");
CREATE INDEX "team_member_team_id_26812b86" ON "team_member" ("team_id");
CREATE INDEX "team_member_updated_by_id_b1d37059" ON "team_member" ("updated_by_id");
CREATE INDEX "team_member_workspace_id_5e13a185" ON "team_member" ("workspace_id");
CREATE INDEX "team_updated_by_id_79bb36f2" ON "team" ("updated_by_id");
CREATE INDEX "team_workspace_id_1d56407f" ON "team" ("workspace_id");
ALTER TABLE "state" ADD CONSTRAINT "state_name_project_id_89897f31_uniq" UNIQUE ("name", "project_id");
ALTER TABLE "state" ADD CONSTRAINT "state_created_by_id_ff51a50d_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "state" ADD CONSTRAINT "state_project_id_23a65fd6_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "state" ADD CONSTRAINT "state_updated_by_id_be298453_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "state" ADD CONSTRAINT "state_workspace_id_2293282d_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "state_slug_bab0af35" ON "state" ("slug");
CREATE INDEX "state_slug_bab0af35_like" ON "state" ("slug" varchar_pattern_ops);
CREATE INDEX "state_created_by_id_ff51a50d" ON "state" ("created_by_id");
CREATE INDEX "state_project_id_23a65fd6" ON "state" ("project_id");
CREATE INDEX "state_updated_by_id_be298453" ON "state" ("updated_by_id");
CREATE INDEX "state_workspace_id_2293282d" ON "state" ("workspace_id");
ALTER TABLE "social_login_connection" ADD CONSTRAINT "social_login_connection_created_by_id_7ca2ef50_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "social_login_connection" ADD CONSTRAINT "social_login_connection_updated_by_id_c13deb42_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "social_login_connection" ADD CONSTRAINT "social_login_connection_user_id_0e26c0c5_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "social_login_connection_created_by_id_7ca2ef50" ON "social_login_connection" ("created_by_id");
CREATE INDEX "social_login_connection_updated_by_id_c13deb42" ON "social_login_connection" ("updated_by_id");
CREATE INDEX "social_login_connection_user_id_0e26c0c5" ON "social_login_connection" ("user_id");
ALTER TABLE "shortcut" ADD CONSTRAINT "shortcut_created_by_id_16a51870_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "shortcut" ADD CONSTRAINT "shortcut_project_id_4d664b3f_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "shortcut" ADD CONSTRAINT "shortcut_updated_by_id_4b58bea5_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "shortcut" ADD CONSTRAINT "shortcut_workspace_id_c00ecd6d_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "shortcut_created_by_id_16a51870" ON "shortcut" ("created_by_id");
CREATE INDEX "shortcut_project_id_4d664b3f" ON "shortcut" ("project_id");
CREATE INDEX "shortcut_updated_by_id_4b58bea5" ON "shortcut" ("updated_by_id");
CREATE INDEX "shortcut_workspace_id_c00ecd6d" ON "shortcut" ("workspace_id");
ALTER TABLE "project_member_invite" ADD CONSTRAINT "project_member_invite_created_by_id_a87df45c_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_member_invite" ADD CONSTRAINT "project_member_invite_project_id_8fb7750e_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_member_invite" ADD CONSTRAINT "project_member_invite_updated_by_id_5aa55c96_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_member_invite" ADD CONSTRAINT "project_member_invite_workspace_id_64e2dc4c_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "project_member_invite_created_by_id_a87df45c" ON "project_member_invite" ("created_by_id");
CREATE INDEX "project_member_invite_project_id_8fb7750e" ON "project_member_invite" ("project_id");
CREATE INDEX "project_member_invite_updated_by_id_5aa55c96" ON "project_member_invite" ("updated_by_id");
CREATE INDEX "project_member_invite_workspace_id_64e2dc4c" ON "project_member_invite" ("workspace_id");
ALTER TABLE "project_identifier" ADD CONSTRAINT "project_identifier_created_by_id_2b6f273a_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_identifier" ADD CONSTRAINT "project_identifier_project_id_13de58a9_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_identifier" ADD CONSTRAINT "project_identifier_updated_by_id_1a00e2a0_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "project_identifier_created_by_id_2b6f273a" ON "project_identifier" ("created_by_id");
CREATE INDEX "project_identifier_updated_by_id_1a00e2a0" ON "project_identifier" ("updated_by_id");
CREATE INDEX "project_workspace_id_01764ff9" ON "project" ("workspace_id");
ALTER TABLE "label" ADD CONSTRAINT "label_created_by_id_aa6ffcfa_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "label" ADD CONSTRAINT "label_project_id_90e0f1a2_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "label" ADD CONSTRAINT "label_updated_by_id_894a5464_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "label" ADD CONSTRAINT "label_workspace_id_c4c9ae5a_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "label_created_by_id_aa6ffcfa" ON "label" ("created_by_id");
CREATE INDEX "label_project_id_90e0f1a2" ON "label" ("project_id");
CREATE INDEX "label_updated_by_id_894a5464" ON "label" ("updated_by_id");
CREATE INDEX "label_workspace_id_c4c9ae5a" ON "label" ("workspace_id");
ALTER TABLE "issue_sequence" ADD CONSTRAINT "issue_sequence_created_by_id_59270506_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_sequence" ADD CONSTRAINT "issue_sequence_issue_id_16e9f00f_fk_issue_id" FOREIGN KEY ("issue_id") REFERENCES "issue" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_sequence" ADD CONSTRAINT "issue_sequence_project_id_ce882e85_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_sequence" ADD CONSTRAINT "issue_sequence_updated_by_id_310c8dd3_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_sequence" ADD CONSTRAINT "issue_sequence_workspace_id_0d3f0fd4_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_sequence_created_by_id_59270506" ON "issue_sequence" ("created_by_id");
CREATE INDEX "issue_sequence_issue_id_16e9f00f" ON "issue_sequence" ("issue_id");
CREATE INDEX "issue_sequence_project_id_ce882e85" ON "issue_sequence" ("project_id");
CREATE INDEX "issue_sequence_updated_by_id_310c8dd3" ON "issue_sequence" ("updated_by_id");
CREATE INDEX "issue_sequence_workspace_id_0d3f0fd4" ON "issue_sequence" ("workspace_id");
ALTER TABLE "issue_property" ADD CONSTRAINT "issue_property_created_by_id_8e92131c_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_property" ADD CONSTRAINT "issue_property_project_id_30e7de7b_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_property" ADD CONSTRAINT "issue_property_updated_by_id_ff158d4d_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_property" ADD CONSTRAINT "issue_property_user_id_0b1d1c8f_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_property" ADD CONSTRAINT "issue_property_workspace_id_17860d65_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_property_created_by_id_8e92131c" ON "issue_property" ("created_by_id");
CREATE INDEX "issue_property_project_id_30e7de7b" ON "issue_property" ("project_id");
CREATE INDEX "issue_property_updated_by_id_ff158d4d" ON "issue_property" ("updated_by_id");
CREATE INDEX "issue_property_workspace_id_17860d65" ON "issue_property" ("workspace_id");
ALTER TABLE "issue_label" ADD CONSTRAINT "issue_label_created_by_id_94075315_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_label" ADD CONSTRAINT "issue_label_issue_id_0f252e52_fk_issue_id" FOREIGN KEY ("issue_id") REFERENCES "issue" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_label" ADD CONSTRAINT "issue_label_label_id_5f22777f_fk_label_id" FOREIGN KEY ("label_id") REFERENCES "label" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_label" ADD CONSTRAINT "issue_label_project_id_eaa2ba39_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_label" ADD CONSTRAINT "issue_label_updated_by_id_a97a6733_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_label" ADD CONSTRAINT "issue_label_workspace_id_b5b1faac_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_label_created_by_id_94075315" ON "issue_label" ("created_by_id");
CREATE INDEX "issue_label_issue_id_0f252e52" ON "issue_label" ("issue_id");
CREATE INDEX "issue_label_label_id_5f22777f" ON "issue_label" ("label_id");
CREATE INDEX "issue_label_project_id_eaa2ba39" ON "issue_label" ("project_id");
CREATE INDEX "issue_label_updated_by_id_a97a6733" ON "issue_label" ("updated_by_id");
CREATE INDEX "issue_label_workspace_id_b5b1faac" ON "issue_label" ("workspace_id");
ALTER TABLE "issue_comment" ADD CONSTRAINT "issue_comment_created_by_id_0765f239_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_comment" ADD CONSTRAINT "issue_comment_issue_id_d0195e35_fk_issue_id" FOREIGN KEY ("issue_id") REFERENCES "issue" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_comment" ADD CONSTRAINT "issue_comment_project_id_db37c105_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_comment" ADD CONSTRAINT "issue_comment_updated_by_id_96cfb86e_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_comment" ADD CONSTRAINT "issue_comment_workspace_id_3f7969ec_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_comment_created_by_id_0765f239" ON "issue_comment" ("created_by_id");
CREATE INDEX "issue_comment_issue_id_d0195e35" ON "issue_comment" ("issue_id");
CREATE INDEX "issue_comment_project_id_db37c105" ON "issue_comment" ("project_id");
CREATE INDEX "issue_comment_updated_by_id_96cfb86e" ON "issue_comment" ("updated_by_id");
CREATE INDEX "issue_comment_workspace_id_3f7969ec" ON "issue_comment" ("workspace_id");
ALTER TABLE "issue_blocker" ADD CONSTRAINT "issue_blocker_block_id_5d15a701_fk_issue_id" FOREIGN KEY ("block_id") REFERENCES "issue" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_blocker" ADD CONSTRAINT "issue_blocker_blocked_by_id_a138af71_fk_issue_id" FOREIGN KEY ("blocked_by_id") REFERENCES "issue" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_blocker" ADD CONSTRAINT "issue_blocker_created_by_id_0d19f6ea_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_blocker" ADD CONSTRAINT "issue_blocker_project_id_380bd100_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_blocker" ADD CONSTRAINT "issue_blocker_updated_by_id_4af87d63_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_blocker" ADD CONSTRAINT "issue_blocker_workspace_id_419a1c71_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_blocker_block_id_5d15a701" ON "issue_blocker" ("block_id");
CREATE INDEX "issue_blocker_blocked_by_id_a138af71" ON "issue_blocker" ("blocked_by_id");
CREATE INDEX "issue_blocker_created_by_id_0d19f6ea" ON "issue_blocker" ("created_by_id");
CREATE INDEX "issue_blocker_project_id_380bd100" ON "issue_blocker" ("project_id");
CREATE INDEX "issue_blocker_updated_by_id_4af87d63" ON "issue_blocker" ("updated_by_id");
CREATE INDEX "issue_blocker_workspace_id_419a1c71" ON "issue_blocker" ("workspace_id");
ALTER TABLE "issue_assignee" ADD CONSTRAINT "issue_assignee_issue_id_assignee_id_4ee260b4_uniq" UNIQUE ("issue_id", "assignee_id");
ALTER TABLE "issue_assignee" ADD CONSTRAINT "issue_assignee_assignee_id_50f5c04e_fk_user_id" FOREIGN KEY ("assignee_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_assignee" ADD CONSTRAINT "issue_assignee_created_by_id_f693d43b_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_assignee" ADD CONSTRAINT "issue_assignee_issue_id_72da08db_fk_issue_id" FOREIGN KEY ("issue_id") REFERENCES "issue" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_assignee" ADD CONSTRAINT "issue_assignee_project_id_61c18bf2_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_assignee" ADD CONSTRAINT "issue_assignee_updated_by_id_c54088aa_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_assignee" ADD CONSTRAINT "issue_assignee_workspace_id_9aad55b7_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_assignee_assignee_id_50f5c04e" ON "issue_assignee" ("assignee_id");
CREATE INDEX "issue_assignee_created_by_id_f693d43b" ON "issue_assignee" ("created_by_id");
CREATE INDEX "issue_assignee_issue_id_72da08db" ON "issue_assignee" ("issue_id");
CREATE INDEX "issue_assignee_project_id_61c18bf2" ON "issue_assignee" ("project_id");
CREATE INDEX "issue_assignee_updated_by_id_c54088aa" ON "issue_assignee" ("updated_by_id");
CREATE INDEX "issue_assignee_workspace_id_9aad55b7" ON "issue_assignee" ("workspace_id");
ALTER TABLE "issue_activity" ADD CONSTRAINT "issue_activity_created_by_id_49516e3d_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_activity" ADD CONSTRAINT "issue_activity_issue_id_807fbde4_fk_issue_id" FOREIGN KEY ("issue_id") REFERENCES "issue" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_activity" ADD CONSTRAINT "issue_activity_issue_comment_id_701f3c3c_fk_issue_comment_id" FOREIGN KEY ("issue_comment_id") REFERENCES "issue_comment" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_activity" ADD CONSTRAINT "issue_activity_project_id_d0ac2ccf_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_activity" ADD CONSTRAINT "issue_activity_updated_by_id_0075f9bd_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_activity" ADD CONSTRAINT "issue_activity_workspace_id_65acaf73_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_activity_created_by_id_49516e3d" ON "issue_activity" ("created_by_id");
CREATE INDEX "issue_activity_issue_id_807fbde4" ON "issue_activity" ("issue_id");
CREATE INDEX "issue_activity_issue_comment_id_701f3c3c" ON "issue_activity" ("issue_comment_id");
CREATE INDEX "issue_activity_project_id_d0ac2ccf" ON "issue_activity" ("project_id");
CREATE INDEX "issue_activity_updated_by_id_0075f9bd" ON "issue_activity" ("updated_by_id");
CREATE INDEX "issue_activity_workspace_id_65acaf73" ON "issue_activity" ("workspace_id");
CREATE INDEX "issue_created_by_id_8f0ae62b" ON "issue" ("created_by_id");
CREATE INDEX "issue_parent_id_ce8d76ba" ON "issue" ("parent_id");
CREATE INDEX "issue_project_id_fea0fc80" ON "issue" ("project_id");
CREATE INDEX "issue_state_id_1a65560d" ON "issue" ("state_id");
CREATE INDEX "issue_updated_by_id_f1261863" ON "issue" ("updated_by_id");
CREATE INDEX "issue_workspace_id_c84878c1" ON "issue" ("workspace_id");
ALTER TABLE "file_asset" ADD CONSTRAINT "file_asset_created_by_id_966942a0_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "file_asset" ADD CONSTRAINT "file_asset_updated_by_id_d6aaf4f0_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "file_asset_created_by_id_966942a0" ON "file_asset" ("created_by_id");
CREATE INDEX "file_asset_updated_by_id_d6aaf4f0" ON "file_asset" ("updated_by_id");
ALTER TABLE "cycle_issue" ADD CONSTRAINT "cycle_issue_created_by_id_30b27539_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle_issue" ADD CONSTRAINT "cycle_issue_cycle_id_ec681215_fk_cycle_id" FOREIGN KEY ("cycle_id") REFERENCES "cycle" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle_issue" ADD CONSTRAINT "cycle_issue_issue_id_fd06e284_fk_issue_id" FOREIGN KEY ("issue_id") REFERENCES "issue" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle_issue" ADD CONSTRAINT "cycle_issue_project_id_6ad3257a_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle_issue" ADD CONSTRAINT "cycle_issue_updated_by_id_cb4516f2_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle_issue" ADD CONSTRAINT "cycle_issue_workspace_id_1d77330e_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "cycle_issue_created_by_id_30b27539" ON "cycle_issue" ("created_by_id");
CREATE INDEX "cycle_issue_cycle_id_ec681215" ON "cycle_issue" ("cycle_id");
CREATE INDEX "cycle_issue_issue_id_fd06e284" ON "cycle_issue" ("issue_id");
CREATE INDEX "cycle_issue_project_id_6ad3257a" ON "cycle_issue" ("project_id");
CREATE INDEX "cycle_issue_updated_by_id_cb4516f2" ON "cycle_issue" ("updated_by_id");
CREATE INDEX "cycle_issue_workspace_id_1d77330e" ON "cycle_issue" ("workspace_id");
CREATE INDEX "cycle_project_id_0b590349" ON "cycle" ("project_id");
CREATE INDEX "cycle_updated_by_id_93baee43" ON "cycle" ("updated_by_id");
CREATE INDEX "cycle_workspace_id_a199e8e1" ON "cycle" ("workspace_id");
ALTER TABLE "workspace_member" ADD CONSTRAINT "workspace_member_workspace_id_member_id_2b61b0e8_uniq" UNIQUE ("workspace_id", "member_id");
ALTER TABLE "workspace_member" ADD CONSTRAINT "workspace_member_created_by_id_8dc8b040_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_member" ADD CONSTRAINT "workspace_member_member_id_824f5497_fk_user_id" FOREIGN KEY ("member_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_member" ADD CONSTRAINT "workspace_member_updated_by_id_1cec0062_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_member" ADD CONSTRAINT "workspace_member_workspace_id_33f66d4b_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "workspace_member_created_by_id_8dc8b040" ON "workspace_member" ("created_by_id");
CREATE INDEX "workspace_member_member_id_824f5497" ON "workspace_member" ("member_id");
CREATE INDEX "workspace_member_updated_by_id_1cec0062" ON "workspace_member" ("updated_by_id");
CREATE INDEX "workspace_member_workspace_id_33f66d4b" ON "workspace_member" ("workspace_id");
ALTER TABLE "project_member" ADD CONSTRAINT "project_member_project_id_member_id_9489e47c_uniq" UNIQUE ("project_id", "member_id");
ALTER TABLE "project_member" ADD CONSTRAINT "project_member_created_by_id_8b363306_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_member" ADD CONSTRAINT "project_member_member_id_9d6b126b_fk_user_id" FOREIGN KEY ("member_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_member" ADD CONSTRAINT "project_member_project_id_11ea1a9e_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_member" ADD CONSTRAINT "project_member_updated_by_id_cf6aaac4_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_member" ADD CONSTRAINT "project_member_workspace_id_88bb9a97_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "project_member_created_by_id_8b363306" ON "project_member" ("created_by_id");
CREATE INDEX "project_member_member_id_9d6b126b" ON "project_member" ("member_id");
CREATE INDEX "project_member_project_id_11ea1a9e" ON "project_member" ("project_id");
CREATE INDEX "project_member_updated_by_id_cf6aaac4" ON "project_member" ("updated_by_id");
CREATE INDEX "project_member_workspace_id_88bb9a97" ON "project_member" ("workspace_id");
COMMIT;
BEGIN;
--
-- Change Meta options on state
--
-- (no-op)
--
-- Rename field description_rt on project to description_text
--
ALTER TABLE "project" RENAME COLUMN "description_rt" TO "description_text";
--
-- Add field actor to issueactivity
--
ALTER TABLE "issue_activity" ADD COLUMN "actor_id" uuid NULL CONSTRAINT "issue_activity_actor_id_52fdd42d_fk_user_id" REFERENCES "user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "issue_activity_actor_id_52fdd42d_fk_user_id" IMMEDIATE;
--
-- Add field actor to issuecomment
--
ALTER TABLE "issue_comment" ADD COLUMN "actor_id" uuid NULL CONSTRAINT "issue_comment_actor_id_d312315b_fk_user_id" REFERENCES "user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "issue_comment_actor_id_d312315b_fk_user_id" IMMEDIATE;
--
-- Add field sequence to state
--
ALTER TABLE "state" ADD COLUMN "sequence" integer DEFAULT 65535 NOT NULL CHECK ("sequence" >= 0);
ALTER TABLE "state" ALTER COLUMN "sequence" DROP DEFAULT;
--
-- Add field company_size to workspace
--
ALTER TABLE "workspace" ADD COLUMN "company_size" integer DEFAULT 10 NOT NULL CHECK ("company_size" >= 0);
ALTER TABLE "workspace" ALTER COLUMN "company_size" DROP DEFAULT;
--
-- Add field company_role to workspacemember
--
ALTER TABLE "workspace_member" ADD COLUMN "company_role" text NULL;
--
-- Alter field issue on cycleissue
--
ALTER TABLE "cycle_issue" ADD CONSTRAINT "cycle_issue_issue_id_fd06e284_uniq" UNIQUE ("issue_id");
CREATE INDEX "issue_activity_actor_id_52fdd42d" ON "issue_activity" ("actor_id");
CREATE INDEX "issue_comment_actor_id_d312315b" ON "issue_comment" ("actor_id");
COMMIT;
BEGIN;
--
-- Alter field user on issueproperty
--
CREATE INDEX "issue_property_user_id_0b1d1c8f" ON "issue_property" ("user_id");
--
-- Alter unique_together for issueproperty (1 constraint(s))
--
ALTER TABLE "issue_property" ADD CONSTRAINT "issue_property_user_id_project_id_fe52668f_uniq" UNIQUE ("user_id", "project_id");
COMMIT;
BEGIN;
--
-- Alter field sequence on state
--
ALTER TABLE "state" ALTER COLUMN "sequence" TYPE double precision USING "sequence"::double precision;
COMMIT;
BEGIN;
--
-- Alter field end_date on cycle
--
ALTER TABLE "cycle" ALTER COLUMN "end_date" DROP NOT NULL;
--
-- Alter field start_date on cycle
--
ALTER TABLE "cycle" ALTER COLUMN "start_date" DROP NOT NULL;
COMMIT;
BEGIN;
--
-- Alter field status on cycle
--
-- (no-op)
COMMIT;
BEGIN;
--
-- Add field parent to label
--
ALTER TABLE "label" ADD COLUMN "parent_id" uuid NULL CONSTRAINT "label_parent_id_7a853296_fk_label_id" REFERENCES "label"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "label_parent_id_7a853296_fk_label_id" IMMEDIATE;
CREATE INDEX "label_parent_id_7a853296" ON "label" ("parent_id");
COMMIT;
BEGIN;
--
-- Add field colour to label
--
ALTER TABLE "label" ADD COLUMN "colour" varchar(255) DEFAULT '' NOT NULL;
ALTER TABLE "label" ALTER COLUMN "colour" DROP DEFAULT;
COMMIT;
BEGIN;
--
-- Add field view_props to projectmember
--
ALTER TABLE "project_member" ADD COLUMN "view_props" jsonb NULL;
--
-- Add field group to state
--
ALTER TABLE "state" ADD COLUMN "group" varchar(20) DEFAULT 'backlog' NOT NULL;
ALTER TABLE "state" ALTER COLUMN "group" DROP DEFAULT;
COMMIT;
BEGIN;
--
-- Add field workspace to projectidentifier
--
ALTER TABLE "project_identifier" ADD COLUMN "workspace_id" uuid NULL CONSTRAINT "project_identifier_workspace_id_6024b517_fk_workspace_id" REFERENCES "workspace"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "project_identifier_workspace_id_6024b517_fk_workspace_id" IMMEDIATE;
--
-- Alter field identifier on project
--
ALTER TABLE "project" ALTER COLUMN "identifier" SET NOT NULL;
--
-- Alter unique_together for project (2 constraint(s))
--
ALTER TABLE "project" ADD CONSTRAINT "project_identifier_workspace_id_35e9a4bf_uniq" UNIQUE ("identifier", "workspace_id");
--
-- Alter unique_together for projectidentifier (1 constraint(s))
--
ALTER TABLE "project_identifier" ADD CONSTRAINT "project_identifier_name_workspace_id_4b7404cb_uniq" UNIQUE ("name", "workspace_id");
CREATE INDEX "project_identifier_workspace_id_6024b517" ON "project_identifier" ("workspace_id");
COMMIT;
BEGIN;
--
-- Create model Module
--
CREATE TABLE "module" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "description_text" jsonb NULL, "description_html" jsonb NULL, "start_date" date NULL, "target_date" date NULL, "status" varchar(20) NOT NULL);
--
-- Add field icon to project
--
ALTER TABLE "project" ADD COLUMN "icon" varchar(255) NULL;
--
-- Add field default_props to projectmember
--
ALTER TABLE "project_member" ADD COLUMN "default_props" jsonb DEFAULT '{"filters": {"type": null}, "orderBy": "-created_at", "collapsed": true, "issueView": "list", "filterIssue": null, "groupByProperty": null, "showEmptyGroups": true}' NOT NULL;
ALTER TABLE "project_member" ALTER COLUMN "default_props" DROP DEFAULT;
--
-- Add field my_issues_prop to user
--
ALTER TABLE "user" ADD COLUMN "my_issues_prop" jsonb NULL;
--
-- Create model ModuleMember
--
CREATE TABLE "module_member" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "member_id" uuid NOT NULL, "module_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Add field created_by to module
--
ALTER TABLE "module" ADD COLUMN "created_by_id" uuid NULL CONSTRAINT "module_created_by_id_ff7a5866_fk_user_id" REFERENCES "user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "module_created_by_id_ff7a5866_fk_user_id" IMMEDIATE;
--
-- Add field lead to module
--
ALTER TABLE "module" ADD COLUMN "lead_id" uuid NULL CONSTRAINT "module_lead_id_04966630_fk_user_id" REFERENCES "user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "module_lead_id_04966630_fk_user_id" IMMEDIATE;
--
-- Add field members to module
--
-- (no-op)
--
-- Add field project to module
--
ALTER TABLE "module" ADD COLUMN "project_id" uuid NOT NULL CONSTRAINT "module_project_id_da84b04f_fk_project_id" REFERENCES "project"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "module_project_id_da84b04f_fk_project_id" IMMEDIATE;
--
-- Add field updated_by to module
--
ALTER TABLE "module" ADD COLUMN "updated_by_id" uuid NULL CONSTRAINT "module_updated_by_id_72ab6d5c_fk_user_id" REFERENCES "user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "module_updated_by_id_72ab6d5c_fk_user_id" IMMEDIATE;
--
-- Add field workspace to module
--
ALTER TABLE "module" ADD COLUMN "workspace_id" uuid NOT NULL CONSTRAINT "module_workspace_id_0a826fef_fk_workspace_id" REFERENCES "workspace"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "module_workspace_id_0a826fef_fk_workspace_id" IMMEDIATE;
--
-- Create model ModuleIssue
--
CREATE TABLE "module_issues" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "issue_id" uuid NOT NULL, "module_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Alter unique_together for module (1 constraint(s))
--
ALTER TABLE "module" ADD CONSTRAINT "module_name_project_id_c730d437_uniq" UNIQUE ("name", "project_id");
ALTER TABLE "module_member" ADD CONSTRAINT "module_member_module_id_member_id_1421c56c_uniq" UNIQUE ("module_id", "member_id");
ALTER TABLE "module_member" ADD CONSTRAINT "module_member_created_by_id_2ed84a65_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_member" ADD CONSTRAINT "module_member_member_id_928f473e_fk_user_id" FOREIGN KEY ("member_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_member" ADD CONSTRAINT "module_member_module_id_f00be7ef_fk_module_id" FOREIGN KEY ("module_id") REFERENCES "module" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_member" ADD CONSTRAINT "module_member_project_id_ec8d2376_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_member" ADD CONSTRAINT "module_member_updated_by_id_a9046438_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_member" ADD CONSTRAINT "module_member_workspace_id_f2f23c73_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "module_member_created_by_id_2ed84a65" ON "module_member" ("created_by_id");
CREATE INDEX "module_member_member_id_928f473e" ON "module_member" ("member_id");
CREATE INDEX "module_member_module_id_f00be7ef" ON "module_member" ("module_id");
CREATE INDEX "module_member_project_id_ec8d2376" ON "module_member" ("project_id");
CREATE INDEX "module_member_updated_by_id_a9046438" ON "module_member" ("updated_by_id");
CREATE INDEX "module_member_workspace_id_f2f23c73" ON "module_member" ("workspace_id");
CREATE INDEX "module_created_by_id_ff7a5866" ON "module" ("created_by_id");
CREATE INDEX "module_lead_id_04966630" ON "module" ("lead_id");
CREATE INDEX "module_project_id_da84b04f" ON "module" ("project_id");
CREATE INDEX "module_updated_by_id_72ab6d5c" ON "module" ("updated_by_id");
CREATE INDEX "module_workspace_id_0a826fef" ON "module" ("workspace_id");
ALTER TABLE "module_issues" ADD CONSTRAINT "module_issues_module_id_issue_id_3322d0ea_uniq" UNIQUE ("module_id", "issue_id");
ALTER TABLE "module_issues" ADD CONSTRAINT "module_issues_created_by_id_de0b995a_fk_user_id" FOREIGN KEY ("created_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_issues" ADD CONSTRAINT "module_issues_issue_id_7caa908b_fk_issue_id" FOREIGN KEY ("issue_id") REFERENCES "issue" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_issues" ADD CONSTRAINT "module_issues_module_id_74e0ed5a_fk_module_id" FOREIGN KEY ("module_id") REFERENCES "module" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_issues" ADD CONSTRAINT "module_issues_project_id_59836d1e_fk_project_id" FOREIGN KEY ("project_id") REFERENCES "project" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_issues" ADD CONSTRAINT "module_issues_updated_by_id_46dbf724_fk_user_id" FOREIGN KEY ("updated_by_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_issues" ADD CONSTRAINT "module_issues_workspace_id_6bf85201_fk_workspace_id" FOREIGN KEY ("workspace_id") REFERENCES "workspace" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "module_issues_created_by_id_de0b995a" ON "module_issues" ("created_by_id");
CREATE INDEX "module_issues_issue_id_7caa908b" ON "module_issues" ("issue_id");
CREATE INDEX "module_issues_module_id_74e0ed5a" ON "module_issues" ("module_id");
CREATE INDEX "module_issues_project_id_59836d1e" ON "module_issues" ("project_id");
CREATE INDEX "module_issues_updated_by_id_46dbf724" ON "module_issues" ("updated_by_id");
CREATE INDEX "module_issues_workspace_id_6bf85201" ON "module_issues" ("workspace_id");
COMMIT;
BEGIN;
--
-- Add field description_html to issue
--
ALTER TABLE "issues" ADD COLUMN "description_html" text DEFAULT '' NOT NULL;
ALTER TABLE "issues" ALTER COLUMN "description_html" DROP DEFAULT;
--
-- Add field description_stripped to issue
--
ALTER TABLE "issues" ADD COLUMN "description_stripped" text DEFAULT '' NOT NULL;
ALTER TABLE "issues" ALTER COLUMN "description_stripped" DROP DEFAULT;
--
-- Add field role to user
--
ALTER TABLE "users" ADD COLUMN "role" varchar(300) NULL;
--
-- Add field view_props to workspacemember
--
ALTER TABLE "workspace_members" ADD COLUMN "view_props" jsonb NULL;
--
-- Alter field description on issue
--
-- (no-op)
COMMIT;
BEGIN;
--
-- Alter unique_together for workspacememberinvite (1 constraint(s))
--
ALTER TABLE "workspace_member_invites" ADD CONSTRAINT "workspace_member_invites_email_workspace_id_9d830009_uniq" UNIQUE ("email", "workspace_id");
COMMIT;
BEGIN;
--
-- Rename field comment on issuecomment to comment_stripped
--
ALTER TABLE "issue_comments" RENAME COLUMN "comment" TO "comment_stripped";
--
-- Add field comment_html to issuecomment
--
ALTER TABLE "issue_comments" ADD COLUMN "comment_html" text DEFAULT '' NOT NULL;
ALTER TABLE "issue_comments" ALTER COLUMN "comment_html" DROP DEFAULT;
--
-- Add field comment_json to issuecomment
--
ALTER TABLE "issue_comments" ADD COLUMN "comment_json" jsonb NULL;
COMMIT;
BEGIN;
--
-- Add field workspace to fileasset
--
ALTER TABLE "file_assets" ADD COLUMN "workspace_id" uuid NULL CONSTRAINT "file_assets_workspace_id_fa50b9c5_fk_workspaces_id" REFERENCES "workspaces"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "file_assets_workspace_id_fa50b9c5_fk_workspaces_id" IMMEDIATE;
--
-- Alter field asset on fileasset
--
-- (no-op)
CREATE INDEX "file_assets_workspace_id_fa50b9c5" ON "file_assets" ("workspace_id");
COMMIT;
BEGIN;
--
-- Add field is_bot to user
--
ALTER TABLE "users" ADD COLUMN "is_bot" boolean DEFAULT false NOT NULL;
ALTER TABLE "users" ALTER COLUMN "is_bot" DROP DEFAULT;
--
-- Alter field description on issue
--
ALTER TABLE "issues" ALTER COLUMN "description" DROP NOT NULL;
--
-- Alter field description_html on issue
--
ALTER TABLE "issues" ALTER COLUMN "description_html" DROP NOT NULL;
--
-- Alter field description_stripped on issue
--
ALTER TABLE "issues" ALTER COLUMN "description_stripped" DROP NOT NULL;
--
-- Create model APIToken
--
CREATE TABLE "api_tokens" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "token" varchar(255) NOT NULL UNIQUE, "label" varchar(255) NOT NULL, "user_type" smallint NOT NULL CHECK ("user_type" >= 0), "created_by_id" uuid NULL, "updated_by_id" uuid NULL, "user_id" uuid NOT NULL);
ALTER TABLE "api_tokens" ADD CONSTRAINT "api_tokens_created_by_id_441e3d24_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "api_tokens" ADD CONSTRAINT "api_tokens_updated_by_id_bcd544cf_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "api_tokens" ADD CONSTRAINT "api_tokens_user_id_2db24e1c_fk_users_id" FOREIGN KEY ("user_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "api_tokens_token_6211101f_like" ON "api_tokens" ("token" varchar_pattern_ops);
CREATE INDEX "api_tokens_created_by_id_441e3d24" ON "api_tokens" ("created_by_id");
CREATE INDEX "api_tokens_updated_by_id_bcd544cf" ON "api_tokens" ("updated_by_id");
CREATE INDEX "api_tokens_user_id_2db24e1c" ON "api_tokens" ("user_id");
COMMIT;
BEGIN;
--
-- Alter field new_value on issueactivity
--
ALTER TABLE "issue_activities" ALTER COLUMN "new_value" TYPE text USING "new_value"::text;
--
-- Alter field old_value on issueactivity
--
ALTER TABLE "issue_activities" ALTER COLUMN "old_value" TYPE text USING "old_value"::text;
COMMIT;
BEGIN;
--
-- Rename field colour on label to color
--
ALTER TABLE "labels" RENAME COLUMN "colour" TO "color";
--
-- Add field workspace to apitoken
--
ALTER TABLE "api_tokens" ADD COLUMN "workspace_id" uuid NULL CONSTRAINT "api_tokens_workspace_id_6791c7bd_fk_workspaces_id" REFERENCES "workspaces"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "api_tokens_workspace_id_6791c7bd_fk_workspaces_id" IMMEDIATE;
--
-- Add field completed_at to issue
--
ALTER TABLE "issues" ADD COLUMN "completed_at" timestamp with time zone NULL;
--
-- Add field sort_order to issue
--
ALTER TABLE "issues" ADD COLUMN "sort_order" double precision DEFAULT 65535.0 NOT NULL;
ALTER TABLE "issues" ALTER COLUMN "sort_order" DROP DEFAULT;
--
-- Add field cycle_view to project
--
ALTER TABLE "projects" ADD COLUMN "cycle_view" boolean DEFAULT true NOT NULL;
ALTER TABLE "projects" ALTER COLUMN "cycle_view" DROP DEFAULT;
--
-- Add field module_view to project
--
ALTER TABLE "projects" ADD COLUMN "module_view" boolean DEFAULT true NOT NULL;
ALTER TABLE "projects" ALTER COLUMN "module_view" DROP DEFAULT;
--
-- Add field default to state
--
ALTER TABLE "states" ADD COLUMN "default" boolean DEFAULT false NOT NULL;
ALTER TABLE "states" ALTER COLUMN "default" DROP DEFAULT;
--
-- Alter field description on issue
--
ALTER TABLE "issues" ALTER COLUMN "description" SET DEFAULT '{}';
UPDATE "issues" SET "description" = '{}' WHERE "description" IS NULL; SET CONSTRAINTS ALL IMMEDIATE;
ALTER TABLE "issues" ALTER COLUMN "description" SET NOT NULL;
ALTER TABLE "issues" ALTER COLUMN "description" DROP DEFAULT;
--
-- Alter field description_html on issue
--
ALTER TABLE "issues" ALTER COLUMN "description_html" SET DEFAULT '<p></p>';
UPDATE "issues" SET "description_html" = '<p></p>' WHERE "description_html" IS NULL; SET CONSTRAINTS ALL IMMEDIATE;
ALTER TABLE "issues" ALTER COLUMN "description_html" SET NOT NULL;
ALTER TABLE "issues" ALTER COLUMN "description_html" DROP DEFAULT;
--
-- Alter field comment_html on issuecomment
--
-- (no-op)
--
-- Alter field comment_json on issuecomment
--
ALTER TABLE "issue_comments" ALTER COLUMN "comment_json" SET DEFAULT '{}';
UPDATE "issue_comments" SET "comment_json" = '{}' WHERE "comment_json" IS NULL; SET CONSTRAINTS ALL IMMEDIATE;
ALTER TABLE "issue_comments" ALTER COLUMN "comment_json" SET NOT NULL;
ALTER TABLE "issue_comments" ALTER COLUMN "comment_json" DROP DEFAULT;
CREATE INDEX "api_tokens_workspace_id_6791c7bd" ON "api_tokens" ("workspace_id");
COMMIT;
BEGIN;
--
-- Create model GithubRepository
--
CREATE TABLE "github_repositories" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(500) NOT NULL, "url" varchar(200) NULL, "config" jsonb NOT NULL, "repository_id" bigint NOT NULL, "owner" varchar(500) NOT NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model Integration
--
CREATE TABLE "integrations" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "title" varchar(400) NOT NULL, "provider" varchar(400) NOT NULL UNIQUE, "network" integer NOT NULL CHECK ("network" >= 0), "description" jsonb NOT NULL, "author" varchar(400) NOT NULL, "webhook_url" text NOT NULL, "webhook_secret" text NOT NULL, "redirect_url" text NOT NULL, "metadata" jsonb NOT NULL, "verified" boolean NOT NULL, "avatar_url" varchar(200) NULL, "created_by_id" uuid NULL, "updated_by_id" uuid NULL);
--
-- Alter field issue on issueactivity
--
SET CONSTRAINTS "issue_activities_issue_id_180e5662_fk_issues_id" IMMEDIATE; ALTER TABLE "issue_activities" DROP CONSTRAINT "issue_activities_issue_id_180e5662_fk_issues_id";
ALTER TABLE "issue_activities" ALTER COLUMN "issue_id" DROP NOT NULL;
ALTER TABLE "issue_activities" ADD CONSTRAINT "issue_activities_issue_id_180e5662_fk_issues_id" FOREIGN KEY ("issue_id") REFERENCES "issues" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Create model WorkspaceIntegration
--
CREATE TABLE "workspace_integrations" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "metadata" jsonb NOT NULL, "config" jsonb NOT NULL, "actor_id" uuid NOT NULL, "api_token_id" uuid NOT NULL, "created_by_id" uuid NULL, "integration_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model IssueLink
--
CREATE TABLE "issue_links" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "title" varchar(255) NULL, "url" varchar(200) NOT NULL, "created_by_id" uuid NULL, "issue_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model GithubRepositorySync
--
CREATE TABLE "github_repository_syncs" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "credentials" jsonb NOT NULL, "actor_id" uuid NOT NULL, "created_by_id" uuid NULL, "label_id" uuid NULL, "project_id" uuid NOT NULL, "repository_id" uuid NOT NULL UNIQUE, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL, "workspace_integration_id" uuid NOT NULL);
--
-- Create model GithubIssueSync
--
CREATE TABLE "github_issue_syncs" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "repo_issue_id" bigint NOT NULL, "github_issue_id" bigint NOT NULL, "issue_url" varchar(200) NOT NULL, "created_by_id" uuid NULL, "issue_id" uuid NOT NULL, "project_id" uuid NOT NULL, "repository_sync_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model GithubCommentSync
--
CREATE TABLE "github_comment_syncs" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "repo_comment_id" bigint NOT NULL, "comment_id" uuid NOT NULL, "created_by_id" uuid NULL, "issue_sync_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
ALTER TABLE "github_repositories" ADD CONSTRAINT "github_repositories_created_by_id_104fa685_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_repositories" ADD CONSTRAINT "github_repositories_project_id_65c546bb_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_repositories" ADD CONSTRAINT "github_repositories_updated_by_id_8aa4d772_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_repositories" ADD CONSTRAINT "github_repositories_workspace_id_c4de7326_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "github_repositories_created_by_id_104fa685" ON "github_repositories" ("created_by_id");
CREATE INDEX "github_repositories_project_id_65c546bb" ON "github_repositories" ("project_id");
CREATE INDEX "github_repositories_updated_by_id_8aa4d772" ON "github_repositories" ("updated_by_id");
CREATE INDEX "github_repositories_workspace_id_c4de7326" ON "github_repositories" ("workspace_id");
ALTER TABLE "integrations" ADD CONSTRAINT "integrations_created_by_id_0b6edd52_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "integrations" ADD CONSTRAINT "integrations_updated_by_id_d6d00d15_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "integrations_provider_6537a106_like" ON "integrations" ("provider" varchar_pattern_ops);
CREATE INDEX "integrations_created_by_id_0b6edd52" ON "integrations" ("created_by_id");
CREATE INDEX "integrations_updated_by_id_d6d00d15" ON "integrations" ("updated_by_id");
ALTER TABLE "workspace_integrations" ADD CONSTRAINT "workspace_integrations_workspace_id_integration_fa041c22_uniq" UNIQUE ("workspace_id", "integration_id");
ALTER TABLE "workspace_integrations" ADD CONSTRAINT "workspace_integrations_actor_id_21619aa1_fk_users_id" FOREIGN KEY ("actor_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_integrations" ADD CONSTRAINT "workspace_integrations_api_token_id_bdb1759b_fk_api_tokens_id" FOREIGN KEY ("api_token_id") REFERENCES "api_tokens" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_integrations" ADD CONSTRAINT "workspace_integrations_created_by_id_37639c73_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_integrations" ADD CONSTRAINT "workspace_integratio_integration_id_6cb0aace_fk_integrati" FOREIGN KEY ("integration_id") REFERENCES "integrations" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_integrations" ADD CONSTRAINT "workspace_integrations_updated_by_id_fce01dcb_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_integrations" ADD CONSTRAINT "workspace_integrations_workspace_id_27ebeb6b_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "workspace_integrations_actor_id_21619aa1" ON "workspace_integrations" ("actor_id");
CREATE INDEX "workspace_integrations_api_token_id_bdb1759b" ON "workspace_integrations" ("api_token_id");
CREATE INDEX "workspace_integrations_created_by_id_37639c73" ON "workspace_integrations" ("created_by_id");
CREATE INDEX "workspace_integrations_integration_id_6cb0aace" ON "workspace_integrations" ("integration_id");
CREATE INDEX "workspace_integrations_updated_by_id_fce01dcb" ON "workspace_integrations" ("updated_by_id");
CREATE INDEX "workspace_integrations_workspace_id_27ebeb6b" ON "workspace_integrations" ("workspace_id");
ALTER TABLE "issue_links" ADD CONSTRAINT "issue_links_created_by_id_5e4aa092_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_links" ADD CONSTRAINT "issue_links_issue_id_7032881f_fk_issues_id" FOREIGN KEY ("issue_id") REFERENCES "issues" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_links" ADD CONSTRAINT "issue_links_project_id_63d6e9ce_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_links" ADD CONSTRAINT "issue_links_updated_by_id_a771cce4_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_links" ADD CONSTRAINT "issue_links_workspace_id_ff9038e7_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_links_created_by_id_5e4aa092" ON "issue_links" ("created_by_id");
CREATE INDEX "issue_links_issue_id_7032881f" ON "issue_links" ("issue_id");
CREATE INDEX "issue_links_project_id_63d6e9ce" ON "issue_links" ("project_id");
CREATE INDEX "issue_links_updated_by_id_a771cce4" ON "issue_links" ("updated_by_id");
CREATE INDEX "issue_links_workspace_id_ff9038e7" ON "issue_links" ("workspace_id");
ALTER TABLE "github_repository_syncs" ADD CONSTRAINT "github_repository_syncs_project_id_repository_id_0f3705e6_uniq" UNIQUE ("project_id", "repository_id");
ALTER TABLE "github_repository_syncs" ADD CONSTRAINT "github_repository_syncs_actor_id_1fa689fe_fk_users_id" FOREIGN KEY ("actor_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_repository_syncs" ADD CONSTRAINT "github_repository_syncs_created_by_id_0df94495_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_repository_syncs" ADD CONSTRAINT "github_repository_syncs_label_id_eb1e9bd7_fk_labels_id" FOREIGN KEY ("label_id") REFERENCES "labels" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_repository_syncs" ADD CONSTRAINT "github_repository_syncs_project_id_e7e8291e_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_repository_syncs" ADD CONSTRAINT "github_repository_sy_repository_id_ead52404_fk_github_re" FOREIGN KEY ("repository_id") REFERENCES "github_repositories" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_repository_syncs" ADD CONSTRAINT "github_repository_syncs_updated_by_id_07e9d065_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_repository_syncs" ADD CONSTRAINT "github_repository_syncs_workspace_id_4a22a8b8_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_repository_syncs" ADD CONSTRAINT "github_repository_sy_workspace_integratio_62858398_fk_workspace" FOREIGN KEY ("workspace_integration_id") REFERENCES "workspace_integrations" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "github_repository_syncs_actor_id_1fa689fe" ON "github_repository_syncs" ("actor_id");
CREATE INDEX "github_repository_syncs_created_by_id_0df94495" ON "github_repository_syncs" ("created_by_id");
CREATE INDEX "github_repository_syncs_label_id_eb1e9bd7" ON "github_repository_syncs" ("label_id");
CREATE INDEX "github_repository_syncs_project_id_e7e8291e" ON "github_repository_syncs" ("project_id");
CREATE INDEX "github_repository_syncs_updated_by_id_07e9d065" ON "github_repository_syncs" ("updated_by_id");
CREATE INDEX "github_repository_syncs_workspace_id_4a22a8b8" ON "github_repository_syncs" ("workspace_id");
CREATE INDEX "github_repository_syncs_workspace_integration_id_62858398" ON "github_repository_syncs" ("workspace_integration_id");
ALTER TABLE "github_issue_syncs" ADD CONSTRAINT "github_issue_syncs_repository_sync_id_issue_id_4b34427e_uniq" UNIQUE ("repository_sync_id", "issue_id");
ALTER TABLE "github_issue_syncs" ADD CONSTRAINT "github_issue_syncs_created_by_id_d02b7c56_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_issue_syncs" ADD CONSTRAINT "github_issue_syncs_issue_id_450cb083_fk_issues_id" FOREIGN KEY ("issue_id") REFERENCES "issues" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_issue_syncs" ADD CONSTRAINT "github_issue_syncs_project_id_4609ad0c_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_issue_syncs" ADD CONSTRAINT "github_issue_syncs_repository_sync_id_ba0d4de4_fk_github_re" FOREIGN KEY ("repository_sync_id") REFERENCES "github_repository_syncs" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_issue_syncs" ADD CONSTRAINT "github_issue_syncs_updated_by_id_e9cd6f86_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_issue_syncs" ADD CONSTRAINT "github_issue_syncs_workspace_id_eae020ad_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "github_issue_syncs_created_by_id_d02b7c56" ON "github_issue_syncs" ("created_by_id");
CREATE INDEX "github_issue_syncs_issue_id_450cb083" ON "github_issue_syncs" ("issue_id");
CREATE INDEX "github_issue_syncs_project_id_4609ad0c" ON "github_issue_syncs" ("project_id");
CREATE INDEX "github_issue_syncs_repository_sync_id_ba0d4de4" ON "github_issue_syncs" ("repository_sync_id");
CREATE INDEX "github_issue_syncs_updated_by_id_e9cd6f86" ON "github_issue_syncs" ("updated_by_id");
CREATE INDEX "github_issue_syncs_workspace_id_eae020ad" ON "github_issue_syncs" ("workspace_id");
ALTER TABLE "github_comment_syncs" ADD CONSTRAINT "github_comment_syncs_issue_sync_id_comment_id_38c82e7b_uniq" UNIQUE ("issue_sync_id", "comment_id");
ALTER TABLE "github_comment_syncs" ADD CONSTRAINT "github_comment_syncs_comment_id_6feec6d1_fk_issue_comments_id" FOREIGN KEY ("comment_id") REFERENCES "issue_comments" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_comment_syncs" ADD CONSTRAINT "github_comment_syncs_created_by_id_b1ef2517_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_comment_syncs" ADD CONSTRAINT "github_comment_syncs_issue_sync_id_5e738eb5_fk_github_is" FOREIGN KEY ("issue_sync_id") REFERENCES "github_issue_syncs" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_comment_syncs" ADD CONSTRAINT "github_comment_syncs_project_id_6d199ace_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_comment_syncs" ADD CONSTRAINT "github_comment_syncs_updated_by_id_bb05c066_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "github_comment_syncs" ADD CONSTRAINT "github_comment_syncs_workspace_id_b54528c8_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "github_comment_syncs_comment_id_6feec6d1" ON "github_comment_syncs" ("comment_id");
CREATE INDEX "github_comment_syncs_created_by_id_b1ef2517" ON "github_comment_syncs" ("created_by_id");
CREATE INDEX "github_comment_syncs_issue_sync_id_5e738eb5" ON "github_comment_syncs" ("issue_sync_id");
CREATE INDEX "github_comment_syncs_project_id_6d199ace" ON "github_comment_syncs" ("project_id");
CREATE INDEX "github_comment_syncs_updated_by_id_bb05c066" ON "github_comment_syncs" ("updated_by_id");
CREATE INDEX "github_comment_syncs_workspace_id_b54528c8" ON "github_comment_syncs" ("workspace_id");
COMMIT;
BEGIN;
--
-- Remove field status from cycle
--
ALTER TABLE "cycles" DROP COLUMN "status" CASCADE;
--
-- Remove field slug from project
--
ALTER TABLE "projects" DROP COLUMN "slug" CASCADE;
--
-- Add field metadata to issuelink
--
ALTER TABLE "issue_links" ADD COLUMN "metadata" jsonb DEFAULT '{}' NOT NULL;
ALTER TABLE "issue_links" ALTER COLUMN "metadata" DROP DEFAULT;
--
-- Add field metadata to modulelink
--
ALTER TABLE "module_links" ADD COLUMN "metadata" jsonb DEFAULT '{}' NOT NULL;
ALTER TABLE "module_links" ALTER COLUMN "metadata" DROP DEFAULT;
--
-- Add field cover_image to project
--
ALTER TABLE "projects" ADD COLUMN "cover_image" varchar(200) NULL;
--
-- Create model ProjectFavorite
--
CREATE TABLE "project_favorites" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "user_id" uuid NOT NULL, "workspace_id" uuid NOT NULL);
--
-- Create model ModuleFavorite
--
CREATE TABLE "module_favorites" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "module_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "user_id" uuid NOT NULL, "workspace_id" uuid NOT NULL);
--
-- Create model CycleFavorite
--
CREATE TABLE "cycle_favorites" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "cycle_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "user_id" uuid NOT NULL, "workspace_id" uuid NOT NULL);
ALTER TABLE "project_favorites" ADD CONSTRAINT "project_favorites_project_id_user_id_e7e43312_uniq" UNIQUE ("project_id", "user_id");
ALTER TABLE "project_favorites" ADD CONSTRAINT "project_favorites_created_by_id_613c0717_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_favorites" ADD CONSTRAINT "project_favorites_project_id_df76634d_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_favorites" ADD CONSTRAINT "project_favorites_updated_by_id_2a663e4d_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_favorites" ADD CONSTRAINT "project_favorites_user_id_500f4f5b_fk_users_id" FOREIGN KEY ("user_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "project_favorites" ADD CONSTRAINT "project_favorites_workspace_id_fa980513_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "project_favorites_created_by_id_613c0717" ON "project_favorites" ("created_by_id");
CREATE INDEX "project_favorites_project_id_df76634d" ON "project_favorites" ("project_id");
CREATE INDEX "project_favorites_updated_by_id_2a663e4d" ON "project_favorites" ("updated_by_id");
CREATE INDEX "project_favorites_user_id_500f4f5b" ON "project_favorites" ("user_id");
CREATE INDEX "project_favorites_workspace_id_fa980513" ON "project_favorites" ("workspace_id");
ALTER TABLE "module_favorites" ADD CONSTRAINT "module_favorites_module_id_user_id_5b36ecc1_uniq" UNIQUE ("module_id", "user_id");
ALTER TABLE "module_favorites" ADD CONSTRAINT "module_favorites_created_by_id_7f84820d_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_favorites" ADD CONSTRAINT "module_favorites_module_id_c4f0736b_fk_modules_id" FOREIGN KEY ("module_id") REFERENCES "modules" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_favorites" ADD CONSTRAINT "module_favorites_project_id_83d9d9e8_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_favorites" ADD CONSTRAINT "module_favorites_updated_by_id_2437fed0_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_favorites" ADD CONSTRAINT "module_favorites_user_id_c5b76375_fk_users_id" FOREIGN KEY ("user_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "module_favorites" ADD CONSTRAINT "module_favorites_workspace_id_65a4ac6f_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "module_favorites_created_by_id_7f84820d" ON "module_favorites" ("created_by_id");
CREATE INDEX "module_favorites_module_id_c4f0736b" ON "module_favorites" ("module_id");
CREATE INDEX "module_favorites_project_id_83d9d9e8" ON "module_favorites" ("project_id");
CREATE INDEX "module_favorites_updated_by_id_2437fed0" ON "module_favorites" ("updated_by_id");
CREATE INDEX "module_favorites_user_id_c5b76375" ON "module_favorites" ("user_id");
CREATE INDEX "module_favorites_workspace_id_65a4ac6f" ON "module_favorites" ("workspace_id");
ALTER TABLE "cycle_favorites" ADD CONSTRAINT "cycle_favorites_cycle_id_user_id_51c1ab91_uniq" UNIQUE ("cycle_id", "user_id");
ALTER TABLE "cycle_favorites" ADD CONSTRAINT "cycle_favorites_created_by_id_e888870b_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle_favorites" ADD CONSTRAINT "cycle_favorites_cycle_id_8224e5ad_fk_cycles_id" FOREIGN KEY ("cycle_id") REFERENCES "cycles" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle_favorites" ADD CONSTRAINT "cycle_favorites_project_id_f2977b66_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle_favorites" ADD CONSTRAINT "cycle_favorites_updated_by_id_8576232f_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle_favorites" ADD CONSTRAINT "cycle_favorites_user_id_8a04268d_fk_users_id" FOREIGN KEY ("user_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "cycle_favorites" ADD CONSTRAINT "cycle_favorites_workspace_id_07359b0b_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "cycle_favorites_created_by_id_e888870b" ON "cycle_favorites" ("created_by_id");
CREATE INDEX "cycle_favorites_cycle_id_8224e5ad" ON "cycle_favorites" ("cycle_id");
CREATE INDEX "cycle_favorites_project_id_f2977b66" ON "cycle_favorites" ("project_id");
CREATE INDEX "cycle_favorites_updated_by_id_8576232f" ON "cycle_favorites" ("updated_by_id");
CREATE INDEX "cycle_favorites_user_id_8a04268d" ON "cycle_favorites" ("user_id");
CREATE INDEX "cycle_favorites_workspace_id_07359b0b" ON "cycle_favorites" ("workspace_id");
COMMIT;
BEGIN;
--
-- Create model Importer
--
CREATE TABLE "importers" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "service" varchar(50) NOT NULL, "status" varchar(50) NOT NULL, "metadata" jsonb NOT NULL, "config" jsonb NOT NULL, "data" jsonb NOT NULL, "created_by_id" uuid NULL, "initiated_by_id" uuid NOT NULL, "project_id" uuid NOT NULL, "token_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model IssueView
--
CREATE TABLE "issue_views" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "query" jsonb NOT NULL, "access" smallint NOT NULL CHECK ("access" >= 0), "query_data" jsonb NOT NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Create model IssueViewFavorite
--
CREATE TABLE "view_favorites" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "user_id" uuid NOT NULL, "view_id" uuid NOT NULL, "workspace_id" uuid NOT NULL);
--
-- Alter unique_together for label (1 constraint(s))
--
ALTER TABLE "labels" ADD CONSTRAINT "labels_name_project_id_d8b1b810_uniq" UNIQUE ("name", "project_id");
--
-- Delete model View
--
DROP TABLE "views" CASCADE;
ALTER TABLE "importers" ADD CONSTRAINT "importers_created_by_id_7dd06433_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "importers" ADD CONSTRAINT "importers_initiated_by_id_3cddbd23_fk_users_id" FOREIGN KEY ("initiated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "importers" ADD CONSTRAINT "importers_project_id_1f8b43ef_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "importers" ADD CONSTRAINT "importers_token_id_c951e89f_fk_api_tokens_id" FOREIGN KEY ("token_id") REFERENCES "api_tokens" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "importers" ADD CONSTRAINT "importers_updated_by_id_3915139e_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "importers" ADD CONSTRAINT "importers_workspace_id_795b8985_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "importers_created_by_id_7dd06433" ON "importers" ("created_by_id");
CREATE INDEX "importers_initiated_by_id_3cddbd23" ON "importers" ("initiated_by_id");
CREATE INDEX "importers_project_id_1f8b43ef" ON "importers" ("project_id");
CREATE INDEX "importers_token_id_c951e89f" ON "importers" ("token_id");
CREATE INDEX "importers_updated_by_id_3915139e" ON "importers" ("updated_by_id");
CREATE INDEX "importers_workspace_id_795b8985" ON "importers" ("workspace_id");
ALTER TABLE "issue_views" ADD CONSTRAINT "issue_views_created_by_id_0d2e456b_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_views" ADD CONSTRAINT "issue_views_project_id_55ee009f_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_views" ADD CONSTRAINT "issue_views_updated_by_id_28cd9870_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_views" ADD CONSTRAINT "issue_views_workspace_id_8785e03d_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_views_created_by_id_0d2e456b" ON "issue_views" ("created_by_id");
CREATE INDEX "issue_views_project_id_55ee009f" ON "issue_views" ("project_id");
CREATE INDEX "issue_views_updated_by_id_28cd9870" ON "issue_views" ("updated_by_id");
CREATE INDEX "issue_views_workspace_id_8785e03d" ON "issue_views" ("workspace_id");
ALTER TABLE "view_favorites" ADD CONSTRAINT "view_favorites_view_id_user_id_3f287788_uniq" UNIQUE ("view_id", "user_id");
ALTER TABLE "view_favorites" ADD CONSTRAINT "view_favorites_created_by_id_dc6047f5_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "view_favorites" ADD CONSTRAINT "view_favorites_project_id_241c521d_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "view_favorites" ADD CONSTRAINT "view_favorites_updated_by_id_2418b683_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "view_favorites" ADD CONSTRAINT "view_favorites_user_id_b1e94c2e_fk_users_id" FOREIGN KEY ("user_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "view_favorites" ADD CONSTRAINT "view_favorites_view_id_3111e893_fk_issue_views_id" FOREIGN KEY ("view_id") REFERENCES "issue_views" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "view_favorites" ADD CONSTRAINT "view_favorites_workspace_id_3dbdd2a2_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "view_favorites_created_by_id_dc6047f5" ON "view_favorites" ("created_by_id");
CREATE INDEX "view_favorites_project_id_241c521d" ON "view_favorites" ("project_id");
CREATE INDEX "view_favorites_updated_by_id_2418b683" ON "view_favorites" ("updated_by_id");
CREATE INDEX "view_favorites_user_id_b1e94c2e" ON "view_favorites" ("user_id");
CREATE INDEX "view_favorites_view_id_3111e893" ON "view_favorites" ("view_id");
CREATE INDEX "view_favorites_workspace_id_3dbdd2a2" ON "view_favorites" ("workspace_id");
COMMIT;
BEGIN;
--
-- Create model Page
--
CREATE TABLE "pages" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" jsonb NOT NULL, "description_html" text NOT NULL, "description_stripped" text NULL, "access" smallint NOT NULL CHECK ("access" >= 0), "created_by_id" uuid NULL, "owned_by_id" uuid NOT NULL);
--
-- Add field issue_views_view to project
--
ALTER TABLE "projects" ADD COLUMN "issue_views_view" boolean DEFAULT true NOT NULL;
ALTER TABLE "projects" ALTER COLUMN "issue_views_view" DROP DEFAULT;
--
-- Alter field service on importer
--
-- (no-op)
--
-- Alter field cover_image on project
--
ALTER TABLE "projects" ALTER COLUMN "cover_image" TYPE varchar(800);
--
-- Create model PageBlock
--
CREATE TABLE "page_blocks" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" jsonb NOT NULL, "description_html" text NOT NULL, "description_stripped" text NULL, "completed_at" timestamp with time zone NULL, "created_by_id" uuid NULL, "issue_id" uuid NULL, "page_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Add field project to page
--
ALTER TABLE "pages" ADD COLUMN "project_id" uuid NOT NULL CONSTRAINT "pages_project_id_272eed09_fk_projects_id" REFERENCES "projects"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "pages_project_id_272eed09_fk_projects_id" IMMEDIATE;
--
-- Add field updated_by to page
--
ALTER TABLE "pages" ADD COLUMN "updated_by_id" uuid NULL CONSTRAINT "pages_updated_by_id_6c42de3e_fk_users_id" REFERENCES "users"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "pages_updated_by_id_6c42de3e_fk_users_id" IMMEDIATE;
--
-- Add field workspace to page
--
ALTER TABLE "pages" ADD COLUMN "workspace_id" uuid NOT NULL CONSTRAINT "pages_workspace_id_c6c51010_fk_workspaces_id" REFERENCES "workspaces"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "pages_workspace_id_c6c51010_fk_workspaces_id" IMMEDIATE;
--
-- Create model PageFavorite
--
CREATE TABLE "page_favorites" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "page_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "user_id" uuid NOT NULL, "workspace_id" uuid NOT NULL);
ALTER TABLE "pages" ADD CONSTRAINT "pages_created_by_id_d109a675_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "pages" ADD CONSTRAINT "pages_owned_by_id_bf50485f_fk_users_id" FOREIGN KEY ("owned_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "pages_created_by_id_d109a675" ON "pages" ("created_by_id");
CREATE INDEX "pages_owned_by_id_bf50485f" ON "pages" ("owned_by_id");
ALTER TABLE "page_blocks" ADD CONSTRAINT "page_blocks_created_by_id_696391e1_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_blocks" ADD CONSTRAINT "page_blocks_issue_id_33cad86b_fk_issues_id" FOREIGN KEY ("issue_id") REFERENCES "issues" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_blocks" ADD CONSTRAINT "page_blocks_page_id_5f55e114_fk_pages_id" FOREIGN KEY ("page_id") REFERENCES "pages" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_blocks" ADD CONSTRAINT "page_blocks_project_id_068d80f7_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_blocks" ADD CONSTRAINT "page_blocks_updated_by_id_1a29acb7_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_blocks" ADD CONSTRAINT "page_blocks_workspace_id_b051825d_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "page_blocks_created_by_id_696391e1" ON "page_blocks" ("created_by_id");
CREATE INDEX "page_blocks_issue_id_33cad86b" ON "page_blocks" ("issue_id");
CREATE INDEX "page_blocks_page_id_5f55e114" ON "page_blocks" ("page_id");
CREATE INDEX "page_blocks_project_id_068d80f7" ON "page_blocks" ("project_id");
CREATE INDEX "page_blocks_updated_by_id_1a29acb7" ON "page_blocks" ("updated_by_id");
CREATE INDEX "page_blocks_workspace_id_b051825d" ON "page_blocks" ("workspace_id");
CREATE INDEX "pages_project_id_272eed09" ON "pages" ("project_id");
CREATE INDEX "pages_updated_by_id_6c42de3e" ON "pages" ("updated_by_id");
CREATE INDEX "pages_workspace_id_c6c51010" ON "pages" ("workspace_id");
ALTER TABLE "page_favorites" ADD CONSTRAINT "page_favorites_page_id_user_id_6e2c24ba_uniq" UNIQUE ("page_id", "user_id");
ALTER TABLE "page_favorites" ADD CONSTRAINT "page_favorites_created_by_id_3b672270_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_favorites" ADD CONSTRAINT "page_favorites_page_id_0896034b_fk_pages_id" FOREIGN KEY ("page_id") REFERENCES "pages" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_favorites" ADD CONSTRAINT "page_favorites_project_id_e0e3c871_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_favorites" ADD CONSTRAINT "page_favorites_updated_by_id_623c7ac5_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_favorites" ADD CONSTRAINT "page_favorites_user_id_162640a9_fk_users_id" FOREIGN KEY ("user_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_favorites" ADD CONSTRAINT "page_favorites_workspace_id_4b7858d9_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "page_favorites_created_by_id_3b672270" ON "page_favorites" ("created_by_id");
CREATE INDEX "page_favorites_page_id_0896034b" ON "page_favorites" ("page_id");
CREATE INDEX "page_favorites_project_id_e0e3c871" ON "page_favorites" ("project_id");
CREATE INDEX "page_favorites_updated_by_id_623c7ac5" ON "page_favorites" ("updated_by_id");
CREATE INDEX "page_favorites_user_id_162640a9" ON "page_favorites" ("user_id");
CREATE INDEX "page_favorites_workspace_id_4b7858d9" ON "page_favorites" ("workspace_id");
COMMIT;
BEGIN;
--
-- Add field color to page
--
ALTER TABLE "pages" ADD COLUMN "color" varchar(255) DEFAULT '' NOT NULL;
ALTER TABLE "pages" ALTER COLUMN "color" DROP DEFAULT;
--
-- Add field sort_order to pageblock
--
ALTER TABLE "page_blocks" ADD COLUMN "sort_order" double precision DEFAULT 65535.0 NOT NULL;
ALTER TABLE "page_blocks" ALTER COLUMN "sort_order" DROP DEFAULT;
--
-- Add field sync to pageblock
--
ALTER TABLE "page_blocks" ADD COLUMN "sync" boolean DEFAULT true NOT NULL;
ALTER TABLE "page_blocks" ALTER COLUMN "sync" DROP DEFAULT;
--
-- Add field page_view to project
--
ALTER TABLE "projects" ADD COLUMN "page_view" boolean DEFAULT true NOT NULL;
ALTER TABLE "projects" ALTER COLUMN "page_view" DROP DEFAULT;
--
-- Create model PageLabel
--
CREATE TABLE "page_labels" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "created_by_id" uuid NULL, "label_id" uuid NOT NULL, "page_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Add field labels to page
--
-- (no-op)
ALTER TABLE "page_labels" ADD CONSTRAINT "page_labels_created_by_id_fbd942c0_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_labels" ADD CONSTRAINT "page_labels_label_id_05958e53_fk_labels_id" FOREIGN KEY ("label_id") REFERENCES "labels" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_labels" ADD CONSTRAINT "page_labels_page_id_0e6cdb3d_fk_pages_id" FOREIGN KEY ("page_id") REFERENCES "pages" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_labels" ADD CONSTRAINT "page_labels_project_id_938a63ca_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_labels" ADD CONSTRAINT "page_labels_updated_by_id_d9fddbff_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "page_labels" ADD CONSTRAINT "page_labels_workspace_id_078bb01c_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "page_labels_created_by_id_fbd942c0" ON "page_labels" ("created_by_id");
CREATE INDEX "page_labels_label_id_05958e53" ON "page_labels" ("label_id");
CREATE INDEX "page_labels_page_id_0e6cdb3d" ON "page_labels" ("page_id");
CREATE INDEX "page_labels_project_id_938a63ca" ON "page_labels" ("project_id");
CREATE INDEX "page_labels_updated_by_id_d9fddbff" ON "page_labels" ("updated_by_id");
CREATE INDEX "page_labels_workspace_id_078bb01c" ON "page_labels" ("workspace_id");
COMMIT;
BEGIN;
--
-- Alter field view_props on projectmember
--
ALTER TABLE "project_members" ALTER COLUMN "view_props" SET DEFAULT '{"filters": {"type": null}, "orderBy": "-created_at", "collapsed": true, "issueView": "list", "filterIssue": null, "groupByProperty": null, "showEmptyGroups": true}';
UPDATE "project_members" SET "view_props" = '{"filters": {"type": null}, "orderBy": "-created_at", "collapsed": true, "issueView": "list", "filterIssue": null, "groupByProperty": null, "showEmptyGroups": true}' WHERE "view_props" IS NULL; SET CONSTRAINTS ALL IMMEDIATE;
ALTER TABLE "project_members" ALTER COLUMN "view_props" SET NOT NULL;
ALTER TABLE "project_members" ALTER COLUMN "view_props" DROP DEFAULT;
COMMIT;
BEGIN;
--
-- Create model Estimate
--
CREATE TABLE "estimates" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Remove field attachments from issue
--
ALTER TABLE "issues" DROP COLUMN "attachments" CASCADE;
--
-- Add field estimate_point to issue
--
ALTER TABLE "issues" ADD COLUMN "estimate_point" integer DEFAULT 0 NOT NULL;
ALTER TABLE "issues" ALTER COLUMN "estimate_point" DROP DEFAULT;
--
-- Create model IssueAttachment
--
CREATE TABLE "issue_attachments" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "attributes" jsonb NOT NULL, "asset" varchar(100) NOT NULL, "created_by_id" uuid NULL, "issue_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Add field estimate to project
--
ALTER TABLE "projects" ADD COLUMN "estimate_id" uuid NULL CONSTRAINT "projects_estimate_id_85c7b2ac_fk_estimates_id" REFERENCES "estimates"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "projects_estimate_id_85c7b2ac_fk_estimates_id" IMMEDIATE;
--
-- Create model EstimatePoint
--
CREATE TABLE "estimate_points" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "key" integer NOT NULL, "description" text NOT NULL, "value" varchar(20) NOT NULL, "created_by_id" uuid NULL, "estimate_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
ALTER TABLE "estimates" ADD CONSTRAINT "estimates_name_project_id_2b42c12c_uniq" UNIQUE ("name", "project_id");
ALTER TABLE "estimates" ADD CONSTRAINT "estimates_created_by_id_7e401493_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "estimates" ADD CONSTRAINT "estimates_project_id_7f195a41_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "estimates" ADD CONSTRAINT "estimates_updated_by_id_b3fcfb1d_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "estimates" ADD CONSTRAINT "estimates_workspace_id_718811eb_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "estimates_created_by_id_7e401493" ON "estimates" ("created_by_id");
CREATE INDEX "estimates_project_id_7f195a41" ON "estimates" ("project_id");
CREATE INDEX "estimates_updated_by_id_b3fcfb1d" ON "estimates" ("updated_by_id");
CREATE INDEX "estimates_workspace_id_718811eb" ON "estimates" ("workspace_id");
ALTER TABLE "issue_attachments" ADD CONSTRAINT "issue_attachments_created_by_id_87be05bb_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_attachments" ADD CONSTRAINT "issue_attachments_issue_id_0faf88bf_fk_issues_id" FOREIGN KEY ("issue_id") REFERENCES "issues" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_attachments" ADD CONSTRAINT "issue_attachments_project_id_a95fe706_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_attachments" ADD CONSTRAINT "issue_attachments_updated_by_id_47dceec1_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "issue_attachments" ADD CONSTRAINT "issue_attachments_workspace_id_c456a532_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "issue_attachments_created_by_id_87be05bb" ON "issue_attachments" ("created_by_id");
CREATE INDEX "issue_attachments_issue_id_0faf88bf" ON "issue_attachments" ("issue_id");
CREATE INDEX "issue_attachments_project_id_a95fe706" ON "issue_attachments" ("project_id");
CREATE INDEX "issue_attachments_updated_by_id_47dceec1" ON "issue_attachments" ("updated_by_id");
CREATE INDEX "issue_attachments_workspace_id_c456a532" ON "issue_attachments" ("workspace_id");
CREATE INDEX "projects_estimate_id_85c7b2ac" ON "projects" ("estimate_id");
ALTER TABLE "estimate_points" ADD CONSTRAINT "estimate_points_value_estimate_id_9d6daac4_uniq" UNIQUE ("value", "estimate_id");
ALTER TABLE "estimate_points" ADD CONSTRAINT "estimate_points_created_by_id_d1b04bd9_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "estimate_points" ADD CONSTRAINT "estimate_points_estimate_id_4b4cb706_fk_estimates_id" FOREIGN KEY ("estimate_id") REFERENCES "estimates" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "estimate_points" ADD CONSTRAINT "estimate_points_project_id_ba9bcb2c_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "estimate_points" ADD CONSTRAINT "estimate_points_updated_by_id_a1da94e1_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "estimate_points" ADD CONSTRAINT "estimate_points_workspace_id_96fc4f92_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "estimate_points_created_by_id_d1b04bd9" ON "estimate_points" ("created_by_id");
CREATE INDEX "estimate_points_estimate_id_4b4cb706" ON "estimate_points" ("estimate_id");
CREATE INDEX "estimate_points_project_id_ba9bcb2c" ON "estimate_points" ("project_id");
CREATE INDEX "estimate_points_updated_by_id_a1da94e1" ON "estimate_points" ("updated_by_id");
CREATE INDEX "estimate_points_workspace_id_96fc4f92" ON "estimate_points" ("workspace_id");
COMMIT;
BEGIN;
--
-- Add field theme to user
--
ALTER TABLE "users" ADD COLUMN "theme" jsonb DEFAULT '{}' NOT NULL;
ALTER TABLE "users" ALTER COLUMN "theme" DROP DEFAULT;
--
-- Alter field estimate_point on issue
--
ALTER TABLE "issues" ALTER COLUMN "estimate_point" DROP NOT NULL;
--
-- Create model WorkspaceTheme
--
CREATE TABLE "workspace_themes" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(300) NOT NULL, "colors" jsonb NOT NULL, "actor_id" uuid NOT NULL, "created_by_id" uuid NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
ALTER TABLE "workspace_themes" ADD CONSTRAINT "workspace_themes_workspace_id_name_500d4836_uniq" UNIQUE ("workspace_id", "name");
ALTER TABLE "workspace_themes" ADD CONSTRAINT "workspace_themes_actor_id_0e94172e_fk_users_id" FOREIGN KEY ("actor_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_themes" ADD CONSTRAINT "workspace_themes_created_by_id_676e2655_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_themes" ADD CONSTRAINT "workspace_themes_updated_by_id_bba863fe_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "workspace_themes" ADD CONSTRAINT "workspace_themes_workspace_id_d1bffad8_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "workspace_themes_actor_id_0e94172e" ON "workspace_themes" ("actor_id");
CREATE INDEX "workspace_themes_created_by_id_676e2655" ON "workspace_themes" ("created_by_id");
CREATE INDEX "workspace_themes_updated_by_id_bba863fe" ON "workspace_themes" ("updated_by_id");
CREATE INDEX "workspace_themes_workspace_id_d1bffad8" ON "workspace_themes" ("workspace_id");
COMMIT;
BEGIN;
--
-- Add field view_props to cycle
--
ALTER TABLE "cycles" ADD COLUMN "view_props" jsonb DEFAULT '{}' NOT NULL;
ALTER TABLE "cycles" ALTER COLUMN "view_props" DROP DEFAULT;
--
-- Add field imported_data to importer
--
ALTER TABLE "importers" ADD COLUMN "imported_data" jsonb NULL;
--
-- Add field view_props to module
--
ALTER TABLE "modules" ADD COLUMN "view_props" jsonb DEFAULT '{}' NOT NULL;
ALTER TABLE "modules" ALTER COLUMN "view_props" DROP DEFAULT;
--
-- Create model SlackProjectSync
--
CREATE TABLE "slack_project_syncs" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "access_token" varchar(300) NOT NULL, "scopes" text NOT NULL, "bot_user_id" varchar(50) NOT NULL, "webhook_url" varchar(1000) NOT NULL, "data" jsonb NOT NULL, "team_id" varchar(30) NOT NULL, "team_name" varchar(300) NOT NULL, "created_by_id" uuid NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL, "workspace_integration_id" uuid NOT NULL);
ALTER TABLE "slack_project_syncs" ADD CONSTRAINT "slack_project_syncs_team_id_project_id_50a144a7_uniq" UNIQUE ("team_id", "project_id");
ALTER TABLE "slack_project_syncs" ADD CONSTRAINT "slack_project_syncs_created_by_id_ec405a17_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "slack_project_syncs" ADD CONSTRAINT "slack_project_syncs_project_id_016dc792_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "slack_project_syncs" ADD CONSTRAINT "slack_project_syncs_updated_by_id_152eb3b5_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "slack_project_syncs" ADD CONSTRAINT "slack_project_syncs_workspace_id_d1822b06_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "slack_project_syncs" ADD CONSTRAINT "slack_project_syncs_workspace_integratio_d89c9b40_fk_workspace" FOREIGN KEY ("workspace_integration_id") REFERENCES "workspace_integrations" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "slack_project_syncs_created_by_id_ec405a17" ON "slack_project_syncs" ("created_by_id");
CREATE INDEX "slack_project_syncs_project_id_016dc792" ON "slack_project_syncs" ("project_id");
CREATE INDEX "slack_project_syncs_updated_by_id_152eb3b5" ON "slack_project_syncs" ("updated_by_id");
CREATE INDEX "slack_project_syncs_workspace_id_d1822b06" ON "slack_project_syncs" ("workspace_id");
CREATE INDEX "slack_project_syncs_workspace_integration_id_d89c9b40" ON "slack_project_syncs" ("workspace_integration_id");
COMMIT;
BEGIN;
--
-- Create model AnalyticView
--
CREATE TABLE "analytic_views" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "query" jsonb NOT NULL, "query_dict" jsonb NOT NULL, "created_by_id" uuid NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
ALTER TABLE "analytic_views" ADD CONSTRAINT "analytic_views_created_by_id_1b3ca0a9_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "analytic_views" ADD CONSTRAINT "analytic_views_updated_by_id_b6d827e1_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "analytic_views" ADD CONSTRAINT "analytic_views_workspace_id_ca6e5c0b_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "analytic_views_created_by_id_1b3ca0a9" ON "analytic_views" ("created_by_id");
CREATE INDEX "analytic_views_updated_by_id_b6d827e1" ON "analytic_views" ("updated_by_id");
CREATE INDEX "analytic_views_workspace_id_ca6e5c0b" ON "analytic_views" ("workspace_id");
COMMIT;
BEGIN;
--
-- Rename field icon on project to emoji
--
ALTER TABLE "projects" RENAME COLUMN "icon" TO "emoji";
--
-- Add field icon_prop to project
--
ALTER TABLE "projects" ADD COLUMN "icon_prop" jsonb NULL;
COMMIT;
BEGIN;
--
-- Create model Inbox
--
CREATE TABLE "inboxes" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(255) NOT NULL, "description" text NOT NULL, "is_default" boolean NOT NULL, "view_props" jsonb NOT NULL, "created_by_id" uuid NULL);
--
-- Add field inbox_view to project
--
ALTER TABLE "projects" ADD COLUMN "inbox_view" boolean DEFAULT false NOT NULL;
ALTER TABLE "projects" ALTER COLUMN "inbox_view" DROP DEFAULT;
--
-- Create model InboxIssue
--
CREATE TABLE "inbox_issues" ("created_at" timestamp with time zone NOT NULL, "updated_at" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "status" integer NOT NULL, "snoozed_till" timestamp with time zone NULL, "source" text NULL, "created_by_id" uuid NULL, "duplicate_to_id" uuid NULL, "inbox_id" uuid NOT NULL, "issue_id" uuid NOT NULL, "project_id" uuid NOT NULL, "updated_by_id" uuid NULL, "workspace_id" uuid NOT NULL);
--
-- Add field project to inbox
--
ALTER TABLE "inboxes" ADD COLUMN "project_id" uuid NOT NULL CONSTRAINT "inboxes_project_id_a0135c66_fk_projects_id" REFERENCES "projects"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "inboxes_project_id_a0135c66_fk_projects_id" IMMEDIATE;
--
-- Add field updated_by to inbox
--
ALTER TABLE "inboxes" ADD COLUMN "updated_by_id" uuid NULL CONSTRAINT "inboxes_updated_by_id_69b7b3ae_fk_users_id" REFERENCES "users"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "inboxes_updated_by_id_69b7b3ae_fk_users_id" IMMEDIATE;
--
-- Add field workspace to inbox
--
ALTER TABLE "inboxes" ADD COLUMN "workspace_id" uuid NOT NULL CONSTRAINT "inboxes_workspace_id_d6178865_fk_workspaces_id" REFERENCES "workspaces"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "inboxes_workspace_id_d6178865_fk_workspaces_id" IMMEDIATE;
--
-- Alter unique_together for inbox (1 constraint(s))
--
ALTER TABLE "inboxes" ADD CONSTRAINT "inboxes_name_project_id_daf38984_uniq" UNIQUE ("name", "project_id");
ALTER TABLE "inboxes" ADD CONSTRAINT "inboxes_created_by_id_9f1cf5ec_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "inboxes_created_by_id_9f1cf5ec" ON "inboxes" ("created_by_id");
ALTER TABLE "inbox_issues" ADD CONSTRAINT "inbox_issues_created_by_id_483bce13_fk_users_id" FOREIGN KEY ("created_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "inbox_issues" ADD CONSTRAINT "inbox_issues_duplicate_to_id_6cb8d961_fk_issues_id" FOREIGN KEY ("duplicate_to_id") REFERENCES "issues" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "inbox_issues" ADD CONSTRAINT "inbox_issues_inbox_id_444b05b9_fk_inboxes_id" FOREIGN KEY ("inbox_id") REFERENCES "inboxes" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "inbox_issues" ADD CONSTRAINT "inbox_issues_issue_id_7d74b224_fk_issues_id" FOREIGN KEY ("issue_id") REFERENCES "issues" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "inbox_issues" ADD CONSTRAINT "inbox_issues_project_id_5117a70b_fk_projects_id" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "inbox_issues" ADD CONSTRAINT "inbox_issues_updated_by_id_d1b2b70f_fk_users_id" FOREIGN KEY ("updated_by_id") REFERENCES "users" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "inbox_issues" ADD CONSTRAINT "inbox_issues_workspace_id_4a61a7bd_fk_workspaces_id" FOREIGN KEY ("workspace_id") REFERENCES "workspaces" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "inbox_issues_created_by_id_483bce13" ON "inbox_issues" ("created_by_id");
CREATE INDEX "inbox_issues_duplicate_to_id_6cb8d961" ON "inbox_issues" ("duplicate_to_id");
CREATE INDEX "inbox_issues_inbox_id_444b05b9" ON "inbox_issues" ("inbox_id");
CREATE INDEX "inbox_issues_issue_id_7d74b224" ON "inbox_issues" ("issue_id");
CREATE INDEX "inbox_issues_project_id_5117a70b" ON "inbox_issues" ("project_id");
CREATE INDEX "inbox_issues_updated_by_id_d1b2b70f" ON "inbox_issues" ("updated_by_id");
CREATE INDEX "inbox_issues_workspace_id_4a61a7bd" ON "inbox_issues" ("workspace_id");
CREATE INDEX "inboxes_project_id_a0135c66" ON "inboxes" ("project_id");
CREATE INDEX "inboxes_updated_by_id_69b7b3ae" ON "inboxes" ("updated_by_id");
CREATE INDEX "inboxes_workspace_id_d6178865" ON "inboxes" ("workspace_id");
COMMIT;
BEGIN;
--
-- Remove field created_by from timelineissue
--
ALTER TABLE "issue_timelines" DROP COLUMN "created_by_id" CASCADE;
--
-- Remove field issue from timelineissue
--
ALTER TABLE "issue_timelines" DROP COLUMN "issue_id" CASCADE;
--
-- Remove field project from timelineissue
--
ALTER TABLE "issue_timelines" DROP COLUMN "project_id" CASCADE;
--
-- Remove field updated_by from timelineissue
--
ALTER TABLE "issue_timelines" DROP COLUMN "updated_by_id" CASCADE;
--
-- Remove field workspace from timelineissue
--
ALTER TABLE "issue_timelines" DROP COLUMN "workspace_id" CASCADE;
--
-- Delete model Shortcut
--
DROP TABLE "shortcuts" CASCADE;
--
-- Delete model TimelineIssue
--
DROP TABLE "issue_timelines" CASCADE;
COMMIT;
BEGIN;
--
-- Add field organization_size to workspace
--
ALTER TABLE "workspaces" ADD COLUMN "organization_size" varchar(20) DEFAULT '2-10' NOT NULL;
ALTER TABLE "workspaces" ALTER COLUMN "organization_size" DROP DEFAULT;
--
-- Raw Python operation
--
-- THIS OPERATION CANNOT BE WRITTEN AS SQL
--
-- Alter field name on workspace
--
ALTER TABLE "workspaces" ALTER COLUMN "name" TYPE varchar(80);
--
-- Alter field slug on workspace
--
ALTER TABLE "workspaces" ALTER COLUMN "slug" TYPE varchar(48);
--
-- Remove field company_size from workspace
--
ALTER TABLE "workspaces" DROP COLUMN "company_size" CASCADE;
COMMIT;
BEGIN;
--
-- Alter field organization_size on workspace
--
-- (no-op)
COMMIT;
